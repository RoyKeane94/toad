function validateTaskForm(e){const t=e.querySelector('input[name="text"]'),s=e.querySelector(".error-message");return t.value.trim()?(s.innerHTML="",t.classList.remove("border-red-500"),t.classList.add("border-[var(--inline-input-border)]"),!0):(s.innerHTML="Please enter a task description",t.classList.remove("border-[var(--inline-input-border)]"),t.classList.add("border-red-500"),t.focus(),!1)}document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("project-switcher-btn"),t=document.getElementById("project-switcher-dropdown"),s=document.getElementById("switcher-chevron"),n=document.getElementById("project-switcher-container");let o=!1;function a(){o=!o,o?(t.classList.remove("opacity-0","invisible","scale-95"),t.classList.add("opacity-100","visible","scale-100"),s.style.transform="rotate(180deg)",e.classList.add("ring-2","ring-[var(--primary-action-bg)]/20")):(t.classList.add("opacity-0","invisible","scale-95"),t.classList.remove("opacity-100","visible","scale-100"),s.style.transform="rotate(0deg)",e.classList.remove("ring-2","ring-[var(--primary-action-bg)]/20"))}function i(){o&&a()}e.addEventListener("click",function(e){e.stopPropagation(),a()}),document.addEventListener("click",function(e){n.contains(e.target)||i()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&i()});function c(){document.querySelectorAll(".column-actions-btn").forEach(e=>{const t=e.nextElementSibling;let s=!1;e.addEventListener("click",function(e){e.stopPropagation(),document.querySelectorAll(".column-actions-dropdown, .row-actions-dropdown").forEach(e=>{e!==t&&(e.classList.add("opacity-0","invisible","scale-95"),e.classList.remove("opacity-100","visible","scale-100"))}),s=!s,s?(t.classList.remove("opacity-0","invisible","scale-95"),t.classList.add("opacity-100","visible","scale-100")):(t.classList.add("opacity-0","invisible","scale-95"),t.classList.remove("opacity-100","visible","scale-100"))}),t.addEventListener("click",function(e){const n=e.target.closest("button");n&&(n.hasAttribute("hx-get")||n.hasAttribute("hx-post"))?setTimeout(()=>{s=!1,t.classList.add("opacity-0","invisible","scale-95"),t.classList.remove("opacity-100","visible","scale-100")},100):(s=!1,t.classList.add("opacity-0","invisible","scale-95"),t.classList.remove("opacity-100","visible","scale-100"))})}),document.querySelectorAll(".row-actions-btn").forEach(e=>{const t=e.nextElementSibling;let s=!1;e.addEventListener("click",function(e){e.stopPropagation(),document.querySelectorAll(".column-actions-dropdown, .row-actions-dropdown").forEach(e=>{e!==t&&(e.classList.add("opacity-0","invisible","scale-95"),e.classList.remove("opacity-100","visible","scale-100"))}),s=!s,s?(t.classList.remove("opacity-0","invisible","scale-95"),t.classList.add("opacity-100","visible","scale-100")):(t.classList.add("opacity-0","invisible","scale-95"),t.classList.remove("opacity-100","visible","scale-100"))}),t.addEventListener("click",function(e){const n=e.target.closest("button");n&&(n.hasAttribute("hx-get")||n.hasAttribute("hx-post"))?setTimeout(()=>{s=!1,t.classList.add("opacity-0","invisible","scale-95"),t.classList.remove("opacity-100","visible","scale-100")},100):(s=!1,t.classList.add("opacity-0","invisible","scale-95"),t.classList.remove("opacity-100","visible","scale-100"))})}),document.addEventListener("click",function(e){e.target.closest(".column-actions-btn")||e.target.closest(".row-actions-btn")||e.target.closest(".column-actions-dropdown")||e.target.closest(".row-actions-dropdown")||document.querySelectorAll(".column-actions-dropdown, .row-actions-dropdown").forEach(e=>{e.classList.add("opacity-0","invisible","scale-95"),e.classList.remove("opacity-100","visible","scale-100")})}),document.addEventListener("keydown",function(e){"Escape"===e.key&&document.querySelectorAll(".column-actions-dropdown, .row-actions-dropdown").forEach(e=>{e.classList.add("opacity-0","invisible","scale-95"),e.classList.remove("opacity-100","visible","scale-100")})})}t.querySelectorAll("a").forEach(e=>{e.addEventListener("mouseenter",function(){this.style.transform="translateX(2px)"}),e.addEventListener("mouseleave",function(){this.style.transform="translateX(0)"})}),c();const l=document.getElementById("delete-task-modal"),r=document.getElementById("delete-modal-content"),d=document.getElementById("task-to-delete"),u=document.getElementById("delete-task-form"),m=document.getElementById("close-delete-modal"),v=document.getElementById("cancel-delete-task");let y=null,f=null;function p(){l.classList.add("opacity-0","invisible"),r.classList.remove("scale-100"),r.classList.add("scale-95"),y=null,f=null}document.addEventListener("click",function(e){if(e.target.closest(".delete-task-btn")){e.preventDefault();const t=e.target.closest(".delete-task-btn");!function(e,t,s){y=e,f=s,d.textContent=t,u.action=s,l.classList.remove("opacity-0","invisible"),r.classList.remove("scale-95"),r.classList.add("scale-100"),setTimeout(()=>v.focus(),100)}(t.dataset.taskId,t.dataset.taskText,t.dataset.deleteUrl)}}),m.addEventListener("click",p),v.addEventListener("click",p),l.addEventListener("click",function(e){e.target===l&&p()}),document.addEventListener("keydown",function(e){"Escape"!==e.key||l.classList.contains("invisible")||p()}),u.addEventListener("submit",function(e){if(e.preventDefault(),!y||!f)return;const t=u.querySelector('button[type="submit"]'),s=t.innerHTML;t.innerHTML='<i class="fas fa-spinner fa-spin mr-2"></i>Deleting...',t.disabled=!0,fetch(f,{method:"POST",headers:{"X-CSRFToken":document.querySelector("[name=csrfmiddlewaretoken]").value,"HX-Request":"true"}}).then(e=>{if(!e.ok)throw new Error("Delete failed");{const e=document.getElementById(`task-${y}`);e&&(e.style.transform="translateX(-100%)",e.style.opacity="0",setTimeout(()=>e.remove(),300)),p()}}).catch(e=>{console.error("Error deleting task:",e),alert("Failed to delete task. Please try again.")}).finally(()=>{t.innerHTML=s,t.disabled=!1})});const L=document.getElementById("modal"),b=document.getElementById("modal-content");function h(){document.querySelectorAll(".task-form").forEach(e=>{const t=e.querySelector('input[name="text"]');t&&e.addEventListener("htmx:afterRequest",function(s){if(s.detail.successful){t.value="",e.classList.contains("add-task-form")?k(e):t.focus();const s=e.querySelector(".error-message");s&&(s.innerHTML="")}})})}function E(){document.querySelectorAll(".add-task-form").forEach(e=>{const t=e.querySelector(".add-task-trigger"),s=e.querySelector(".add-task-collapsed"),n=e.querySelector(".add-task-expanded"),o=e.querySelector(".add-task-cancel"),a=e.querySelector('input[name="text"]');t&&s&&n&&o&&a&&(t.addEventListener("click",function(t){t.preventDefault(),g(e)}),o.addEventListener("click",function(t){t.preventDefault(),k(e)}),a.addEventListener("focus",function(){"none"!==s.style.display&&g(e)}))}),document.addEventListener("click",function(e){e.target.closest(".add-task-form")||document.querySelectorAll(".add-task-form").forEach(e=>{k(e)})}),document.addEventListener("keydown",function(e){"Escape"===e.key&&document.querySelectorAll(".add-task-form").forEach(e=>{k(e)})})}function g(e){const t=e.querySelector(".add-task-collapsed"),s=e.querySelector(".add-task-expanded"),n=e.querySelector('input[name="text"]');t&&s&&n&&(t.style.display="none",s.classList.remove("hidden"),setTimeout(()=>{n.focus()},100))}function k(e){const t=e.querySelector(".add-task-collapsed"),s=e.querySelector(".add-task-expanded"),n=e.querySelector('input[name="text"]'),o=e.querySelector(".error-message");t&&s&&(t.style.display="block",s.classList.add("hidden"),n&&(n.value="",n.classList.remove("border-red-500"),n.classList.add("border-[var(--inline-input-border)]")),o&&(o.innerHTML=""))}function w(){const e=document.querySelector(".grid-container");if(!e)return;let t=null,s=0;function n(){const t=e.querySelector(".grid-table");if(!t)return;const s=(parseInt(e.dataset.totalColumns)||0)-1;if(0===s)return;const n=window.innerWidth;let o;o=n<=768?200:n<=1024?250:300;const a=e.clientWidth-o,i=Math.min(3,s),c=Math.floor(a/i),l=t.querySelector("colgroup col.category-column");l&&(l.style.width=o+"px");t.querySelectorAll("colgroup col.data-column").forEach(e=>{e.style.width=c+"px"});const r=o+s*c;return t.style.width=r+"px",{totalDataColumns:s,dataColumnWidth:c,categoryWidth:o,visibleDataColumns:i}}function o(){if(!t)return;const o=document.querySelector(".grid-scroll-progress"),a=n();if(!a)return;const i=a.totalDataColumns;!function(){const t=n();if(!t)return;const o=e.scrollLeft,a=t.dataColumnWidth;s=Math.round(o/a),s=Math.max(0,Math.min(s,t.totalDataColumns-1))}();const c=i>3;if(c){const e=s<i-3;if(s>0?(t.leftBtn.classList.add("active"),t.leftBtn.disabled=!1):(t.leftBtn.classList.remove("active"),t.leftBtn.disabled=!0),e?(t.rightBtn.classList.add("active"),t.rightBtn.disabled=!1):(t.rightBtn.classList.remove("active"),t.rightBtn.disabled=!0),o){const e=i-3,t=e>0?s/e*100:0;o.style.width=Math.min(100,Math.max(0,t))+"%"}}else t.leftBtn.classList.remove("active"),t.leftBtn.disabled=!0,t.rightBtn.classList.remove("active"),t.rightBtn.disabled=!0,o&&(o.style.width="0%");e.classList.toggle("can-scroll-left",c&&s>0),e.classList.toggle("can-scroll-right",c&&s<i-3)}n(),function(){const a=document.querySelector(".left-scroll-btn"),i=document.querySelector(".right-scroll-btn");if(!a||!i)return;t={leftBtn:a,rightBtn:i};let c=document.querySelector(".grid-scroll-progress-track");if(!c){c=document.createElement("div"),c.className="grid-scroll-progress-track";const t=document.createElement("div");t.className="grid-scroll-progress",t.style.width="0%",c.appendChild(t),e.parentElement.appendChild(c)}a.addEventListener("click",()=>{const t=n();if(!t)return;const a=Math.max(0,s-1),i=a*t.dataColumnWidth;e.scrollTo({left:i,behavior:"smooth"}),s=a,setTimeout(o,50),setTimeout(o,300)}),i.addEventListener("click",()=>{const t=n();if(!t)return;const a=Math.max(0,t.totalDataColumns-3),i=Math.min(a,s+1),c=i*t.dataColumnWidth;e.scrollTo({left:c,behavior:"smooth"}),s=i,setTimeout(o,50),setTimeout(o,300)})}(),o(),e.addEventListener("scroll",o),setTimeout(o,100),setTimeout(o,500),window.addEventListener("resize",function(){n(),setTimeout(o,100)}),e.addEventListener("keydown",function(e){"ArrowLeft"===e.key&&e.ctrlKey?(e.preventDefault(),t.leftBtn.click()):"ArrowRight"===e.key&&e.ctrlKey&&(e.preventDefault(),t.rightBtn.click())}),e.tabIndex=0,e.style.outline="none",e.style.scrollBehavior="auto",e.addEventListener("wheel",function(e){Math.abs(e.deltaX)>Math.abs(e.deltaY)&&e.preventDefault()},{passive:!1})}document.body.addEventListener("openModal",function(){L.classList.remove("opacity-0","invisible"),L.classList.add("opacity-100","visible"),b.classList.remove("scale-95"),b.classList.add("scale-100")}),document.body.addEventListener("closeModal",function(){L.classList.add("opacity-0","invisible"),L.classList.remove("opacity-100","visible"),b.classList.add("scale-95"),b.classList.remove("scale-100")}),document.body.addEventListener("refreshGrid",function(){window.location.reload()}),L.addEventListener("click",function(e){e.target===L&&document.body.dispatchEvent(new Event("closeModal"))}),document.addEventListener("keydown",function(e){"Escape"!==e.key||L.classList.contains("invisible")||document.body.dispatchEvent(new Event("closeModal"))}),document.addEventListener("click",function(e){e.target.closest(".close-modal")&&document.body.dispatchEvent(new Event("closeModal"))}),h(),E(),document.body.addEventListener("htmx:afterSwap",function(){h(),E(),c()}),document.body.addEventListener("htmx:afterSettle",function(){h(),E(),c()}),w(),document.body.addEventListener("htmx:afterSettle",function(){w()})});