class GridManager{constructor(){this.state={currentCol:0,dataColWidth:0,totalDataColumns:0,columnsToShow:3,isDropdownOpen:!1,currentTaskId:null,currentDeleteUrl:null},this.elements={},this.observers=new Map,this.eventListeners=new Map,this.init()}cacheElements(){const e={switcherBtn:"#project-switcher-btn",switcherDropdown:"#project-switcher-dropdown",switcherChevron:"#switcher-chevron",switcherContainer:"#project-switcher-container",scrollable:".grid-table-scrollable",leftBtn:".left-scroll-btn",rightBtn:".right-scroll-btn",gridTable:".grid-table",dataCols:"col.data-column",deleteModal:"#delete-task-modal",deleteModalContent:"#delete-modal-content",taskToDelete:"#task-to-delete",deleteTaskForm:"#delete-task-form",closeDeleteModal:"#close-delete-modal",cancelDeleteTask:"#cancel-delete-task",modal:"#modal",modalContent:"#modal-content",fixedRows:".grid-table-fixed tr",scrollRows:".grid-table-scrollable .grid-table tr",fixedTable:".grid-table-fixed",dataTable:".grid-table"};Object.keys(e).forEach(t=>{const s=e[t];s.includes("All")||t.includes("Rows")||"dataCols"===t?this.elements[t]=document.querySelectorAll(s):this.elements[t]=document.querySelector(s)})}addEventListeners(){[["document","click",this.handleDocumentClick.bind(this)],["document","keydown",this.handleKeydown.bind(this)],["document","htmx:beforeRequest",this.handleHtmxBeforeRequest.bind(this)],["document","htmx:afterRequest",this.handleHtmxAfterRequest.bind(this)],["document","htmx:afterSwap",this.handleHtmxAfterSwap.bind(this)],["document","htmx:afterSettle",this.handleHtmxAfterSettle.bind(this)],["document","htmx:responseError",this.handleHtmxError.bind(this)],["document","htmx:sendError",this.handleHtmxError.bind(this)],["body","openModal",this.showModal.bind(this)],["body","closeModal",this.hideModal.bind(this)],["body","refreshGrid",this.handleRefreshGrid.bind(this)],["body","scrollToEnd",this.handleScrollToEnd.bind(this)],["body","resetGridToInitial",this.handleResetGridToInitial.bind(this)]].forEach(([e,t,s])=>{const o="document"===e?document:document.body;o.addEventListener(t,s),this.eventListeners.has(o)||this.eventListeners.set(o,[]),this.eventListeners.get(o).push({event:t,handler:s})}),document.addEventListener("scrollToEnd",e=>{console.log("scrollToEnd event caught!",e),this.handleScrollToEnd()}),document.addEventListener("htmx:trigger",e=>{console.log("HTMX trigger event:",e.detail),"scrollToEnd"===e.detail.trigger&&(console.log("scrollToEnd trigger detected via htmx:trigger!"),this.handleScrollToEnd())}),document.body.addEventListener("htmx:afterRequest",e=>{if(e.detail.xhr&&e.detail.xhr.getResponseHeader("HX-Trigger")){const t=e.detail.xhr.getResponseHeader("HX-Trigger");console.log("HX-Trigger header found:",t),t&&t.includes("scrollToEnd")&&(console.log("scrollToEnd trigger detected via HX-Trigger header!"),this.handleScrollToEnd())}})}handleDocumentClick(e){if(e.target.closest('[hx-target="#modal-content"]')&&(this.clearModalContent(),this.showModal()),e.target.closest("#project-switcher-btn"))return e.stopPropagation(),void this.toggleProjectSwitcher();e.target.closest("#project-switcher-container")||this.closeProjectSwitcher();const t=e.target.closest(".column-actions-btn, .row-actions-btn");if(t)return e.stopPropagation(),void this.toggleActionDropdown(t);e.target.closest(".column-actions-dropdown, .row-actions-dropdown")||this.closeAllActionDropdowns();const s=e.target.closest(".delete-task-btn");if(s)return e.preventDefault(),void this.showDeleteModal(s.dataset.taskId,s.dataset.taskText,s.dataset.deleteUrl);const o=e.target.closest(".close-modal, #close-delete-modal, #cancel-delete-task");if(o)return void("close-delete-modal"===o.id||"cancel-delete-task"===o.id?this.hideDeleteModal():o.classList.contains("close-modal")&&this.hideModal());e.target===this.elements.deleteModal&&this.hideDeleteModal(),e.target===this.elements.modal&&this.hideModal();const l=e.target.closest(".add-task-trigger");if(l)return e.preventDefault(),void this.expandAddTaskForm(l.closest(".add-task-form"));const i=e.target.closest(".add-task-cancel");if(i)return e.preventDefault(),void this.collapseAddTaskForm(i.closest(".add-task-form"));e.target.closest(".add-task-form")||this.collapseAllAddTaskForms();const n=e.target.closest('input[type="checkbox"][name="completed"]');if(n){const e=n.closest("form");if(e&&e.hasAttribute("hx-post")){const e=n.id.replace("checkbox-",""),t=document.getElementById(`task-text-${e}`);t&&(n.checked?(n.classList.add("checkbox-completed"),t.classList.add("task-completed-strikethrough")):(n.classList.remove("checkbox-completed"),t.classList.remove("task-completed-strikethrough")))}}}handleKeydown(e){"Escape"===e.key&&(this.closeProjectSwitcher(),this.closeAllActionDropdowns(),this.hideDeleteModal(),this.hideModal(),this.collapseAllAddTaskForms())}toggleProjectSwitcher(){this.elements.switcherDropdown&&(this.state.isDropdownOpen=!this.state.isDropdownOpen,this.updateProjectSwitcherUI())}closeProjectSwitcher(){this.state.isDropdownOpen&&(this.state.isDropdownOpen=!1,this.updateProjectSwitcherUI())}updateProjectSwitcherUI(){const{switcherDropdown:e,switcherChevron:t,switcherBtn:s}=this.elements;if(!e)return;const o=this.state.isDropdownOpen?{remove:["opacity-0","invisible","scale-95"],add:["opacity-100","visible","scale-100"]}:{remove:["opacity-100","visible","scale-100"],add:["opacity-0","invisible","scale-95"]};e.classList.remove(...o.remove),e.classList.add(...o.add),t&&(t.style.transform=this.state.isDropdownOpen?"rotate(180deg)":"rotate(0deg)"),s&&(s.classList.toggle("ring-2",this.state.isDropdownOpen),s.classList.toggle("ring-[var(--primary-action-bg)]/20",this.state.isDropdownOpen))}toggleActionDropdown(e){const t=e.nextElementSibling;if(!t)return;this.closeAllActionDropdowns(t);const s=!t.classList.contains("opacity-0");this.setDropdownState(t,!s)}closeAllActionDropdowns(e=null){document.querySelectorAll(".column-actions-dropdown, .row-actions-dropdown").forEach(t=>{t!==e&&this.setDropdownState(t,!1)})}setDropdownState(e,t){const s=t?{remove:["opacity-0","invisible","scale-95"],add:["opacity-100","visible","scale-100"]}:{remove:["opacity-100","visible","scale-100"],add:["opacity-0","invisible","scale-95"]};e.classList.remove(...s.remove),e.classList.add(...s.add)}showDeleteModal(e,t,s){this.state.currentTaskId=e,this.state.currentDeleteUrl=s,this.elements.taskToDelete&&(this.elements.taskToDelete.textContent=t),this.elements.deleteTaskForm&&(this.elements.deleteTaskForm.action=s,this.elements.deleteTaskForm.setAttribute("hx-post",s),"undefined"!=typeof htmx&&htmx.process(this.elements.deleteTaskForm)),this.setModalState(this.elements.deleteModal,this.elements.deleteModalContent,!0),setTimeout(()=>this.elements.cancelDeleteTask?.focus(),100)}hideDeleteModal(){this.setModalState(this.elements.deleteModal,this.elements.deleteModalContent,!1),this.state.currentTaskId=null,this.state.currentDeleteUrl=null}showModal(){this.setModalState(this.elements.modal,this.elements.modalContent,!0)}hideModal(){this.setModalState(this.elements.modal,this.elements.modalContent,!1)}clearModalContent(){this.elements.modalContent&&(this.elements.modalContent.innerHTML='\n                <div class="flex items-center justify-center p-8">\n                    <div class="flex items-center space-x-3">\n                        <div class="animate-spin w-6 h-6 border-2 border-[var(--primary-action-bg)] border-t-transparent rounded-full"></div>\n                        <span class="text-[var(--text-secondary)]">Loading...</span>\n                    </div>\n                </div>\n            ')}setModalState(e,t,s){e&&t&&(s?(e.classList.remove("opacity-0","invisible"),e.classList.add("opacity-100","visible"),t.classList.remove("scale-95"),t.classList.add("scale-100")):(e.classList.add("opacity-0","invisible"),e.classList.remove("opacity-100","visible"),t.classList.add("scale-95"),t.classList.remove("scale-100")))}expandAddTaskForm(e){if(!e)return;const t=e.querySelector(".add-task-collapsed"),s=e.querySelector(".add-task-expanded"),o=e.querySelector('input[name="text"]');t&&s&&(t.style.display="none",s.classList.remove("hidden"),setTimeout(()=>o?.focus(),100))}collapseAddTaskForm(e){if(!e)return;const t=e.querySelector(".add-task-collapsed"),s=e.querySelector(".add-task-expanded"),o=e.querySelector('input[name="text"]'),l=e.querySelector(".error-message");t&&s&&(t.style.display="block",s.classList.add("hidden"),o&&(o.value="",o.classList.remove("border-red-500"),o.classList.add("border-[var(--inline-input-border)]")),l&&(l.innerHTML=""))}collapseAllAddTaskForms(){document.querySelectorAll(".add-task-form").forEach(e=>{this.collapseAddTaskForm(e)})}setupGridScrolling(e=!1){const{scrollable:t,leftBtn:s,rightBtn:o,gridTable:l}=this.elements;if(!(t&&s&&o&&l))return;const i=document.querySelectorAll(".data-column");if(this.elements.dataCols=i,i.length){if(this.state.totalDataColumns=parseInt(l.dataset.totalDataColumns)||i.length,this.state.columnsToShow=Math.min(3,this.state.totalDataColumns),console.log("Setup grid scrolling - Total columns:",this.state.totalDataColumns),s.onclick||(s.onclick=()=>this.scrollToCol(this.state.currentCol-1),o.onclick=()=>this.scrollToCol(this.state.currentCol+1)),!this.observers.has("resize")){const e=new ResizeObserver(()=>{const e=t.scrollLeft;this.calculateAndApplyWidths(),t.scrollLeft=e,this.updateScrollButtons()});e.observe(t),this.observers.set("resize",e)}this.calculateAndApplyWidths(),this.updateScrollButtons(),e||this.restoreScrollPosition()}}calculateAndApplyWidths(){const{scrollable:e,gridTable:t,dataCols:s}=this.elements;if(e&&s.length){if(this.state.columnsToShow>0){const o=e.clientWidth;this.state.dataColWidth=o/this.state.columnsToShow,s.forEach(e=>{e.style.width=`${this.state.dataColWidth}px`});const l=this.state.dataColWidth*this.state.totalDataColumns;t.style.width=`${l}px`}this.syncRowHeights()}}scrollToCol(e,t="smooth"){const{scrollable:s}=this.elements;if(!s)return;this.state.currentCol=Math.max(0,Math.min(e,this.state.totalDataColumns-this.state.columnsToShow));const o=this.state.currentCol*this.state.dataColWidth;s.scrollTo({left:o,behavior:t}),this.updateScrollButtons()}updateScrollButtons(){const{leftBtn:e,rightBtn:t}=this.elements;e&&t&&(this.state.totalDataColumns<=this.state.columnsToShow?(e.disabled=t.disabled=!0,e.style.display=t.style.display="none"):(e.style.display=t.style.display="flex",e.disabled=0===this.state.currentCol,t.disabled=this.state.currentCol>=this.state.totalDataColumns-this.state.columnsToShow))}syncRowHeights(){const{fixedRows:e,scrollRows:t}=this.elements;if(e.length===t.length)for(let s=0;s<e.length;s++){const o=e[s].querySelector("td, th"),l=t[s].querySelector("td, th");if(o&&l){o.style.height=l.style.height="auto";const e=Math.max(o.offsetHeight,l.offsetHeight);o.style.height=l.style.height=`${e}px`}}}restoreScrollPosition(){const e=sessionStorage.getItem("scrollToEnd"),t=sessionStorage.getItem("grid-scroll-position");if(sessionStorage.getItem("resetToInitial"))return console.log("Resetting to initial state"),sessionStorage.removeItem("resetToInitial"),this.state.currentCol=0,void this.scrollToCol(0,"auto");if(e)console.log("Restoring scroll to end position"),sessionStorage.removeItem("scrollToEnd"),setTimeout(()=>{const e=document.querySelectorAll(".data-column").length;if(console.log("Actual column count from DOM:",e),e>0){this.state.totalDataColumns=e,this.elements.gridTable&&(this.elements.gridTable.dataset.totalDataColumns=e),this.calculateAndApplyWidths();const t=Math.max(0,this.state.totalDataColumns-this.state.columnsToShow);console.log("Scrolling to column index:",t),this.scrollToCol(t,"smooth")}else console.log("No data columns found, defaulting to start"),this.scrollToCol(0,"auto")},100);else if(t){sessionStorage.removeItem("grid-scroll-position");const e=parseFloat(t);this.elements.scrollable&&e>0&&(this.elements.scrollable.scrollLeft=e,this.state.currentCol=this.state.dataColWidth>0?Math.round(e/this.state.dataColWidth):0,this.updateScrollButtons())}else this.scrollToCol(0,"auto")}handleScrollToEnd(){console.log("ScrollToEnd triggered"),sessionStorage.setItem("scrollToEnd","true"),window.location.reload()}handleRefreshGrid(){this.elements.scrollable&&sessionStorage.setItem("grid-scroll-position",this.elements.scrollable.scrollLeft.toString()),window.location.reload()}handleResetGridToInitial(){sessionStorage.removeItem("grid-scroll-position"),sessionStorage.removeItem("scrollToEnd"),sessionStorage.setItem("resetToInitial","true"),this.state.currentCol=0,this.elements.scrollable&&(this.elements.scrollable.scrollLeft=0),window.location.reload()}updateColumnHeader(e,t){console.log(`Updating column ${e} to ${t}`);const s=document.querySelectorAll(`[data-column-id="${e}"]`);console.log(`Found ${s.length} column headers`),s.forEach(e=>{const s=e.querySelector("span.font-semibold");console.log("Name element:",s),s&&(s.textContent=t,console.log(`Updated column header to: ${t}`))})}updateRowHeader(e,t){console.log(`Updating row ${e} to ${t}`);const s=document.querySelectorAll(`[data-row-id="${e}"]`);console.log(`Found ${s.length} row headers`),s.forEach(e=>{const s=e.querySelector("span.font-semibold");console.log("Name element:",s),s&&(s.textContent=t,console.log(`Updated row header to: ${t}`))})}handleHtmxBeforeRequest(e){console.log("HTMX Before Request:",e.detail);const t=e.detail.requestConfig?.url||"unknown",s=e.detail.requestConfig?.verb||"unknown";console.log("About to make request:",s,t),"FORM"===e.target.tagName&&(console.log("Form submission detected:",e.target),console.log("Form action:",e.target.action),console.log("Form method:",e.target.method),console.log("Form data:",new FormData(e.target)))}handleHtmxAfterRequest(e){console.log("Full HTMX event detail:",e.detail);const t=e.detail.requestConfig?.url||e.target?.getAttribute("hx-post")||e.target?.getAttribute("hx-get")||"unknown",s=e.detail.requestConfig?.verb||e.detail.requestConfig?.type||(e.target?.getAttribute("hx-post")?"post":e.target?.getAttribute("hx-get")?"get":"unknown");if(console.log("HTMX After Request:",t,"Method:",s,"Success:",e.detail.successful),console.log("Target element:",e.target),console.log("Request config verb:",e.detail.requestConfig?.verb),console.log("Request config type:",e.detail.requestConfig?.type),console.log("Target hx-post:",e.target?.getAttribute("hx-post")),console.log("Target hx-get:",e.target?.getAttribute("hx-get")),e.detail.xhr&&e.detail.xhr.responseText&&(console.log("Response text length:",e.detail.xhr.responseText.length),console.log("Response text preview:",e.detail.xhr.responseText.substring(0,200))),e.detail.successful&&e.detail.xhr){const t=e.detail.xhr.getResponseHeader("HX-Trigger");if(t){if(console.log("HX-Trigger header found:",t),t.includes("scrollToEnd"))return console.log("scrollToEnd trigger detected via HX-Trigger header!"),void this.handleScrollToEnd();if(t.includes("refreshGrid"))return console.log("refreshGrid trigger detected via HX-Trigger header!"),void this.handleRefreshGrid();if(t.includes("resetGridToInitial"))return console.log("resetGridToInitial trigger detected via HX-Trigger header!"),void this.handleResetGridToInitial()}}if(console.log("Checking if this is a POST request..."),console.log("Method matches post?","post"===s||"POST"===s),console.log("Has responseText?",!!e.detail.xhr.responseText),e.detail.successful&&("post"===s||"POST"===s)&&e.detail.xhr.responseText){console.log("Processing POST request...");const s=document.querySelector(".grid-table-scrollable"),o=s?s.scrollLeft:0;try{const l=JSON.parse(e.detail.xhr.responseText);if(console.log("Parsed JSON response:",l),console.log("Response success:",l.success),l.success){if(console.log("Processing successful response..."),console.log("URL to check:",t),console.log("URL includes /column/?",t.includes("/column/")),console.log("URL includes /edit/?",t.includes("/edit/")),console.log("URL regex match:",t.match(/\/column\/\d+\/edit\//)),t.includes("/columns/")&&t.includes("/edit/")||t.match(/\/columns\/\d+\/edit\//)){console.log("Column update POST detected!");let e=null;const i=t.match(/\/columns\/(\d+)\//);if(console.log("URL match result:",i),i)e=i[1];else{const s=t.split("/");console.log("URL parts:",s);const o=s.indexOf("columns");console.log("Column index:",o),o>=0&&o+1<s.length&&(e=s[o+1])}if(console.log("Column ID extracted:",e),e&&l.column_name)return this.updateColumnHeader(e,l.column_name),this.hideModal(),void setTimeout(()=>{s&&(s.scrollLeft=o,this.state.dataColWidth>0&&(this.state.currentCol=Math.round(o/this.state.dataColWidth),this.updateScrollButtons()))},50)}if(t.includes("/rows/")&&t.includes("/edit/")||t.match(/\/rows\/\d+\/edit\//)){console.log("Row update POST detected!");let e=null;const i=t.match(/\/rows\/(\d+)\//);if(i)e=i[1];else{const s=t.split("/"),o=s.indexOf("rows");o>=0&&o+1<s.length&&(e=s[o+1])}if(console.log("Row ID extracted:",e),e&&l.row_name)return this.updateRowHeader(e,l.row_name),this.hideModal(),void setTimeout(()=>{s&&(s.scrollLeft=o,this.state.dataColWidth>0&&(this.state.currentCol=Math.round(o/this.state.dataColWidth),this.updateScrollButtons()))},50)}}}catch(t){console.log("Response is not JSON (likely HTML form content)"),console.log("Error:",t),console.log("Response text:",e.detail.xhr.responseText)}}if(e.detail.successful&&"delete-task-form"===e.target.id&&"post"===e.detail.requestConfig.verb){const e=this.state.currentTaskId;if(e){const t=document.getElementById(`task-${e}`);if(t){const e=document.querySelector(".grid-table-scrollable"),s=e?e.scrollLeft:0;t.style.transition="all 0.3s ease",t.style.opacity="0",t.style.transform="scale(0.95)",setTimeout(()=>{t.remove(),e&&s>0&&(e.scrollLeft=s),setTimeout(()=>{this.syncRowHeights(),e&&s>0&&(e.scrollLeft=s,this.state.dataColWidth>0&&(this.state.currentCol=Math.round(s/this.state.dataColWidth),this.updateScrollButtons()))},10)},300)}}return void this.hideDeleteModal()}if(!e.detail.successful&&"delete-task-form"===e.target.id&&"post"===e.detail.requestConfig.verb)return void alert("Failed to delete task. Please try again.");if(e.detail.successful&&e.target.closest("#modal-content")&&"post"===e.detail.requestConfig.verb){let t=null;try{t=JSON.parse(e.detail.xhr.response)}catch(e){return console.log("Non-JSON response, reloading page"),void window.location.reload()}const s=document.getElementById("modal"),o=document.getElementById("modal-content");s.classList.add("opacity-0","invisible"),o.classList.remove("scale-100"),o.classList.add("scale-95"),t&&t.task_id&&t.task_html?setTimeout(()=>{const e=document.getElementById(`task-${t.task_id}`);if(e){const s=document.querySelector(".grid-table-scrollable"),o=s?s.scrollLeft:0;e.outerHTML=t.task_html;const l=document.getElementById(`task-${t.task_id}`);l&&"undefined"!=typeof htmx&&htmx.process(l),s&&o>0&&(s.scrollLeft=o),setTimeout(()=>{this.syncRowHeights(),s&&o>0&&(s.scrollLeft=o,this.state.dataColWidth>0&&(this.state.currentCol=Math.round(o/this.state.dataColWidth),this.updateScrollButtons()))},10)}else window.location.reload()},300):setTimeout(()=>window.location.reload(),300)}if(e.detail.requestConfig&&"post"===e.detail.requestConfig.verb&&e.target.closest("#modal-content")&&this.elements.scrollable&&sessionStorage.setItem("grid-scroll-position",this.elements.scrollable.scrollLeft.toString()),!e.detail.successful&&e.target.closest('form[hx-post*="toggle"]')){const t=e.target.closest("form").querySelector('input[type="checkbox"][name="completed"]');if(t){const e=t.id.replace("checkbox-",""),s=document.getElementById(`task-text-${e}`);t.checked=!t.checked,s&&(t.checked?(t.classList.add("checkbox-completed"),s.classList.add("task-completed-strikethrough")):(t.classList.remove("checkbox-completed"),s.classList.remove("task-completed-strikethrough")))}}if(e.detail.successful&&e.target.closest('form[hx-post*="toggle"]'))try{const t=JSON.parse(e.detail.xhr.response);if(t.success&&t.hasOwnProperty("completed")){const s=e.target.closest("form").querySelector('input[type="checkbox"][name="completed"]');if(s){const e=s.id.replace("checkbox-",""),o=document.getElementById(`task-text-${e}`);s.checked=t.completed,o&&(t.completed?(s.classList.add("checkbox-completed"),o.classList.add("task-completed-strikethrough")):(s.classList.remove("checkbox-completed"),o.classList.remove("task-completed-strikethrough")))}}}catch(e){}if(e.detail.successful){const t=e.target.closest(".task-form");if(t){const e=t.querySelector('input[name="text"]');e&&(e.value="",t.classList.contains("add-task-form")?this.collapseAddTaskForm(t):e.focus());const s=t.querySelector(".error-message");s&&(s.innerHTML="")}}}handleHtmxAfterSwap(e){if("modal-content"===e.detail.target.id){const t=e.detail.target;this.showModal();const s=t.querySelector('textarea, input[name="text"]');if(s){const e=e=>{if("Enter"===e.key){if("textarea"===s.tagName.toLowerCase()&&e.shiftKey)return;e.preventDefault();const t=s.closest("form");if(t){const e=t.querySelector('button[type="submit"]');e?e.click():t.submit()}}};s.addEventListener("keydown",e),setTimeout(()=>{s.focus(),s.setSelectionRange(s.value.length,s.value.length)},150)}}e.detail.target&&e.detail.target.closest('[id^="tasks-"]')&&void 0!==window._hyperscript&&window._hyperscript.processNode(e.detail.target);const t=e.detail.target&&"modal-content"===e.detail.target.id,s=e.detail.target&&e.detail.target.closest("#grid-content"),o=e.detail.target&&e.detail.target.closest('[id^="task-"]');t?(console.log("Modal content swapped, processing HTMX attributes"),"undefined"!=typeof htmx&&(htmx.process(e.detail.target),console.log("HTMX processing completed for modal content")),this.reinitializeComponents()):s&&!o&&setTimeout(()=>this.syncRowHeights(),10)}handleHtmxAfterSettle(e){const t=e.detail.target&&(e.detail.target.closest("#grid-content")||e.detail.target.closest(".task-form")),s=e.detail.target&&e.detail.target.closest('[id^="task-"]');if(t&&!s){const e=this.elements.scrollable?this.elements.scrollable.scrollLeft:0;setTimeout(()=>{this.syncRowHeights(),this.elements.scrollable&&this.elements.scrollable.scrollLeft!==e&&(this.elements.scrollable.scrollLeft=e)},10)}}handleHtmxError(e){e.detail.target&&"modal-content"===e.detail.target.id&&(this.elements.modalContent.innerHTML='\n                <div class="flex items-center justify-center p-8">\n                    <div class="flex flex-col items-center space-y-3 text-center">\n                        <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center">\n                            <i class="fas fa-exclamation-triangle text-red-500 text-xl"></i>\n                        </div>\n                        <div>\n                            <h3 class="text-lg font-medium text-[var(--text-primary)]">Error Loading Content</h3>\n                            <p class="text-sm text-[var(--text-secondary)] mt-1">Unable to load the requested content. Please try again.</p>\n                        </div>\n                        <button type="button" \n                                class="close-modal mt-4 px-4 py-2 bg-[var(--primary-action-bg)] hover:bg-[var(--primary-action-hover-bg)] text-white rounded-lg transition-colors">\n                            Close\n                        </button>\n                    </div>\n                </div>\n            ')}reinitializeComponents(){const e=this.elements.scrollable?this.elements.scrollable.scrollLeft:0;this.cacheElements(),this.setupGridScrolling(!0),this.elements.scrollable&&e>0&&(this.elements.scrollable.scrollLeft=e,this.state.currentCol=this.state.dataColWidth>0?Math.round(e/this.state.dataColWidth):0,this.updateScrollButtons())}cleanup(){this.eventListeners.forEach((e,t)=>{e.forEach(({event:e,handler:s})=>{t.removeEventListener(e,s)})}),this.eventListeners.clear(),this.observers.forEach(e=>e.disconnect()),this.observers.clear()}init(){this.cacheElements(),this.addEventListeners(),this.setupGridScrolling(),"undefined"!=typeof htmx&&(htmx.config.disableSelector="[hx-disable]",htmx.config.useTemplateFragments=!1),console.log("Grid JavaScript optimized and loaded")}}function validateTaskForm(e){const t=e.querySelector('input[name="text"]'),s=e.querySelector(".error-message");return t.value.trim()?(s.innerHTML="",t.classList.remove("border-red-500"),t.classList.add("border-[var(--inline-input-border)]"),!0):(s.innerHTML="Please enter a task description",t.classList.remove("border-[var(--inline-input-border)]"),t.classList.add("border-red-500"),t.focus(),!1)}document.addEventListener("DOMContentLoaded",function(){window.gridManager=new GridManager}),window.addEventListener("beforeunload",function(){window.gridManager&&window.gridManager.cleanup()});