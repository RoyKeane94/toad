function validateTaskForm(e){const t=e.querySelector('input[name="text"]'),s=e.querySelector(".error-message");return t.value.trim()?(s.innerHTML="",t.classList.remove("border-red-500"),t.classList.add("border-[var(--inline-input-border)]"),!0):(s.innerHTML="Please enter a task description",t.classList.remove("border-[var(--inline-input-border)]"),t.classList.add("border-red-500"),t.focus(),!1)}document.addEventListener("DOMContentLoaded",function(){function e(){const e=document.getElementById("project-switcher-btn"),t=document.getElementById("project-switcher-dropdown"),s=document.getElementById("switcher-chevron"),n=document.getElementById("project-switcher-container");if(!(e&&t&&s&&n))return;let o=!1;function i(){o=!o,o?(t.classList.remove("opacity-0","invisible","scale-95"),t.classList.add("opacity-100","visible","scale-100"),s.style.transform="rotate(180deg)",e.classList.add("ring-2","ring-[var(--primary-action-bg)]/20")):(t.classList.add("opacity-0","invisible","scale-95"),t.classList.remove("opacity-100","visible","scale-100"),s.style.transform="rotate(0deg)",e.classList.remove("ring-2","ring-[var(--primary-action-bg)]/20"))}function c(){o&&i()}const a=e.cloneNode(!0);e.parentNode.replaceChild(a,e),a.addEventListener("click",function(e){e.stopPropagation(),i()}),document.addEventListener("click",function(e){n.contains(e.target)||c()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&c()});t.querySelectorAll("a").forEach(e=>{e.addEventListener("mouseenter",function(){this.style.transform="translateX(2px)"}),e.addEventListener("mouseleave",function(){this.style.transform="translateX(0)"})})}function t(){document.querySelectorAll(".column-actions-btn").forEach(e=>{const t=e.nextElementSibling;let s=!1;e.addEventListener("click",function(e){e.stopPropagation(),document.querySelectorAll(".column-actions-dropdown, .row-actions-dropdown").forEach(e=>{e!==t&&(e.classList.add("opacity-0","invisible","scale-95"),e.classList.remove("opacity-100","visible","scale-100"))}),s=!s,s?(t.classList.remove("opacity-0","invisible","scale-95"),t.classList.add("opacity-100","visible","scale-100")):(t.classList.add("opacity-0","invisible","scale-95"),t.classList.remove("opacity-100","visible","scale-100"))}),t.addEventListener("click",function(e){const n=e.target.closest("button");n&&(n.hasAttribute("hx-get")||n.hasAttribute("hx-post"))?setTimeout(()=>{s=!1,t.classList.add("opacity-0","invisible","scale-95"),t.classList.remove("opacity-100","visible","scale-100")},100):(s=!1,t.classList.add("opacity-0","invisible","scale-95"),t.classList.remove("opacity-100","visible","scale-100"))})}),document.querySelectorAll(".row-actions-btn").forEach(e=>{const t=e.nextElementSibling;let s=!1;e.addEventListener("click",function(e){e.stopPropagation(),document.querySelectorAll(".column-actions-dropdown, .row-actions-dropdown").forEach(e=>{e!==t&&(e.classList.add("opacity-0","invisible","scale-95"),e.classList.remove("opacity-100","visible","scale-100"))}),s=!s,s?(t.classList.remove("opacity-0","invisible","scale-95"),t.classList.add("opacity-100","visible","scale-100")):(t.classList.add("opacity-0","invisible","scale-95"),t.classList.remove("opacity-100","visible","scale-100"))}),t.addEventListener("click",function(e){const n=e.target.closest("button");n&&(n.hasAttribute("hx-get")||n.hasAttribute("hx-post"))?setTimeout(()=>{s=!1,t.classList.add("opacity-0","invisible","scale-95"),t.classList.remove("opacity-100","visible","scale-100")},100):(s=!1,t.classList.add("opacity-0","invisible","scale-95"),t.classList.remove("opacity-100","visible","scale-100"))})}),document.addEventListener("click",function(e){e.target.closest(".column-actions-btn")||e.target.closest(".row-actions-btn")||e.target.closest(".column-actions-dropdown")||e.target.closest(".row-actions-dropdown")||document.querySelectorAll(".column-actions-dropdown, .row-actions-dropdown").forEach(e=>{e.classList.add("opacity-0","invisible","scale-95"),e.classList.remove("opacity-100","visible","scale-100")})}),document.addEventListener("keydown",function(e){"Escape"===e.key&&document.querySelectorAll(".column-actions-dropdown, .row-actions-dropdown").forEach(e=>{e.classList.add("opacity-0","invisible","scale-95"),e.classList.remove("opacity-100","visible","scale-100")})})}console.log("Grid JavaScript loaded and DOM ready"),e(),t();const s=document.getElementById("delete-task-modal"),n=document.getElementById("delete-modal-content"),o=document.getElementById("task-to-delete"),i=document.getElementById("delete-task-form"),c=document.getElementById("close-delete-modal"),a=document.getElementById("cancel-delete-task");let l=null,d=null;function r(){s.classList.add("opacity-0","invisible"),n.classList.remove("scale-100"),n.classList.add("scale-95"),l=null,d=null}document.addEventListener("click",function(e){if(e.target.closest(".delete-task-btn")){e.preventDefault();const t=e.target.closest(".delete-task-btn");!function(e,t,c){l=e,d=c,o.textContent=t,i.action=c,s.classList.remove("opacity-0","invisible"),n.classList.remove("scale-95"),n.classList.add("scale-100"),setTimeout(()=>a.focus(),100)}(t.dataset.taskId,t.dataset.taskText,t.dataset.deleteUrl)}}),c.addEventListener("click",r),a.addEventListener("click",r),s.addEventListener("click",function(e){e.target===s&&r()}),document.addEventListener("keydown",function(e){"Escape"!==e.key||s.classList.contains("invisible")||r()}),i.addEventListener("submit",function(e){if(e.preventDefault(),!l||!d)return;const t=i.querySelector('button[type="submit"]'),s=t.innerHTML;t.innerHTML='<i class="fas fa-spinner fa-spin mr-2"></i>Deleting...',t.disabled=!0,fetch(d,{method:"POST",headers:{"X-CSRFToken":document.querySelector("[name=csrfmiddlewaretoken]").value,"HX-Request":"true"}}).then(e=>{if(!e.ok)throw new Error("Delete failed");{const e=document.getElementById(`task-${l}`);e&&(e.style.transform="translateX(-100%)",e.style.opacity="0",setTimeout(()=>e.remove(),300)),r()}}).catch(e=>{console.error("Error deleting task:",e),alert("Failed to delete task. Please try again.")}).finally(()=>{t.innerHTML=s,t.disabled=!1})});const u=document.getElementById("modal"),m=document.getElementById("modal-content");function y(){document.querySelectorAll(".task-form").forEach(e=>{const t=e.querySelector('input[name="text"]');t&&e.addEventListener("htmx:afterRequest",function(s){if(s.detail.successful){t.value="",e.classList.contains("add-task-form")?p(e):t.focus();const s=e.querySelector(".error-message");s&&(s.innerHTML="")}})})}function v(){document.querySelectorAll(".add-task-form").forEach(e=>{const t=e.querySelector(".add-task-trigger"),s=e.querySelector(".add-task-collapsed"),n=e.querySelector(".add-task-expanded"),o=e.querySelector(".add-task-cancel"),i=e.querySelector('input[name="text"]');t&&s&&n&&o&&i&&(t.addEventListener("click",function(t){t.preventDefault(),f(e)}),o.addEventListener("click",function(t){t.preventDefault(),p(e)}),i.addEventListener("focus",function(){"none"!==s.style.display&&f(e)}))}),document.addEventListener("click",function(e){e.target.closest(".add-task-form")||document.querySelectorAll(".add-task-form").forEach(e=>{p(e)})}),document.addEventListener("keydown",function(e){"Escape"===e.key&&document.querySelectorAll(".add-task-form").forEach(e=>{p(e)})})}function f(e){const t=e.querySelector(".add-task-collapsed"),s=e.querySelector(".add-task-expanded"),n=e.querySelector('input[name="text"]');t&&s&&n&&(t.style.display="none",s.classList.remove("hidden"),setTimeout(()=>{n.focus()},100))}function p(e){const t=e.querySelector(".add-task-collapsed"),s=e.querySelector(".add-task-expanded"),n=e.querySelector('input[name="text"]'),o=e.querySelector(".error-message");t&&s&&(t.style.display="block",s.classList.add("hidden"),n&&(n.value="",n.classList.remove("border-red-500"),n.classList.add("border-[var(--inline-input-border)]")),o&&(o.innerHTML=""))}function L(){const e=document.querySelector(".grid-table-scrollable");if(!e)return;const t=document.querySelector(".left-scroll-btn"),s=document.querySelector(".right-scroll-btn"),n=e.querySelector(".grid-table"),o=e.querySelectorAll("col.data-column");if(!t||!s||!n||0===o.length)return;const i=parseInt(n.dataset.totalDataColumns),c=Math.min(3,i);let a=0,l=0;function d(){if(c>0){const t=e.clientWidth;l=t/c,o.forEach(e=>{e.style.width=`${l}px`});const s=l*i;n.style.width=`${s}px`}b()}function r(){i<=c?(t.disabled=!0,s.disabled=!0,t.style.display="none",s.style.display="none"):(t.style.display="flex",s.style.display="flex",t.disabled=0===a,s.disabled=a>=i-c)}function u(t,s="smooth"){a=Math.max(0,Math.min(t,i-c));const n=a*l;e.scrollTo({left:n,behavior:s}),r()}t.onclick=()=>u(a-1),s.onclick=()=>u(a+1);new ResizeObserver(e=>{d(),u(a,"auto")}).observe(e),d(),r();const m=sessionStorage.getItem("grid-scroll-position");m?(sessionStorage.removeItem("grid-scroll-position"),setTimeout(()=>{if(l>0){u(Math.round(parseFloat(m)/l),"auto")}else u(0,"auto")},50)):u(0,"auto"),document.addEventListener("htmx:beforeRequest",function(t){sessionStorage.setItem("grid-scroll-position",e.scrollLeft.toString())})}function b(){const e=document.querySelectorAll(".grid-table-fixed tr"),t=document.querySelectorAll(".grid-table-scrollable .grid-table tr");if(e.length===t.length)for(let s=0;s<e.length;s++){const n=e[s].querySelector("td, th"),o=t[s].querySelector("td, th");if(n&&o){n.style.height="auto",o.style.height="auto";const e=Math.max(n.offsetHeight,o.offsetHeight);n.style.height=e+"px",o.style.height=e+"px"}}}document.body.addEventListener("openModal",function(){u.classList.remove("opacity-0","invisible"),u.classList.add("opacity-100","visible"),m.classList.remove("scale-95"),m.classList.add("scale-100")}),document.body.addEventListener("closeModal",function(){u.classList.add("opacity-0","invisible"),u.classList.remove("opacity-100","visible"),m.classList.add("scale-95"),m.classList.remove("scale-100")}),document.body.addEventListener("refreshGrid",function(){window.location.reload()}),u.addEventListener("click",function(e){e.target===u&&document.body.dispatchEvent(new Event("closeModal"))}),document.addEventListener("keydown",function(e){"Escape"!==e.key||u.classList.contains("invisible")||document.body.dispatchEvent(new Event("closeModal"))}),document.addEventListener("click",function(e){e.target.closest(".close-modal")&&document.body.dispatchEvent(new Event("closeModal"))}),y(),v(),document.body.addEventListener("htmx:afterSwap",function(){e(),y(),v(),t()}),document.body.addEventListener("htmx:afterSettle",function(){e(),y(),v(),t()}),document.body.addEventListener("htmx:afterSettle",function(s){console.log("HTMX Swap: Re-initializing components."),e(),t(),v(),L(),setTimeout(b,50)}),L()});