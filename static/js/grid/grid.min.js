function validateTaskForm(e){const t=e.querySelector('input[name="text"]'),n=e.querySelector(".error-message");return t.value.trim()?(n.innerHTML="",t.classList.remove("border-red-500"),t.classList.add("border-[var(--inline-input-border)]"),!0):(n.innerHTML="Please enter a task description",t.classList.remove("border-[var(--inline-input-border)]"),t.classList.add("border-red-500"),t.focus(),!1)}document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("project-switcher-btn"),t=document.getElementById("project-switcher-dropdown"),n=document.getElementById("switcher-chevron"),s=document.getElementById("project-switcher-container");let o=!1;function c(){o=!o,o?(t.classList.remove("opacity-0","invisible","scale-95"),t.classList.add("opacity-100","visible","scale-100"),n.style.transform="rotate(180deg)",e.classList.add("ring-2","ring-[var(--primary-action-bg)]/20")):(t.classList.add("opacity-0","invisible","scale-95"),t.classList.remove("opacity-100","visible","scale-100"),n.style.transform="rotate(0deg)",e.classList.remove("ring-2","ring-[var(--primary-action-bg)]/20"))}function i(){o&&c()}e.addEventListener("click",function(e){e.stopPropagation(),c()}),document.addEventListener("click",function(e){s.contains(e.target)||i()}),document.addEventListener("keydown",function(e){"Escape"===e.key&&i()});function l(){document.querySelectorAll(".column-actions-btn").forEach(e=>{const t=e.nextElementSibling;let n=!1;e.addEventListener("click",function(e){e.stopPropagation(),document.querySelectorAll(".column-actions-dropdown, .row-actions-dropdown").forEach(e=>{e!==t&&(e.classList.add("opacity-0","invisible","scale-95"),e.classList.remove("opacity-100","visible","scale-100"))}),n=!n,n?(t.classList.remove("opacity-0","invisible","scale-95"),t.classList.add("opacity-100","visible","scale-100")):(t.classList.add("opacity-0","invisible","scale-95"),t.classList.remove("opacity-100","visible","scale-100"))}),t.addEventListener("click",function(){n=!1,t.classList.add("opacity-0","invisible","scale-95"),t.classList.remove("opacity-100","visible","scale-100")})}),document.querySelectorAll(".row-actions-btn").forEach(e=>{const t=e.nextElementSibling;let n=!1;e.addEventListener("click",function(e){e.stopPropagation(),document.querySelectorAll(".column-actions-dropdown, .row-actions-dropdown").forEach(e=>{e!==t&&(e.classList.add("opacity-0","invisible","scale-95"),e.classList.remove("opacity-100","visible","scale-100"))}),n=!n,n?(t.classList.remove("opacity-0","invisible","scale-95"),t.classList.add("opacity-100","visible","scale-100")):(t.classList.add("opacity-0","invisible","scale-95"),t.classList.remove("opacity-100","visible","scale-100"))}),t.addEventListener("click",function(){n=!1,t.classList.add("opacity-0","invisible","scale-95"),t.classList.remove("opacity-100","visible","scale-100")})}),document.addEventListener("click",function(e){e.target.closest(".column-actions-btn")||e.target.closest(".row-actions-btn")||document.querySelectorAll(".column-actions-dropdown, .row-actions-dropdown").forEach(e=>{e.classList.add("opacity-0","invisible","scale-95"),e.classList.remove("opacity-100","visible","scale-100")})}),document.addEventListener("keydown",function(e){"Escape"===e.key&&document.querySelectorAll(".column-actions-dropdown, .row-actions-dropdown").forEach(e=>{e.classList.add("opacity-0","invisible","scale-95"),e.classList.remove("opacity-100","visible","scale-100")})})}t.querySelectorAll("a").forEach(e=>{e.addEventListener("mouseenter",function(){this.style.transform="translateX(2px)"}),e.addEventListener("mouseleave",function(){this.style.transform="translateX(0)"})}),l();const a=document.getElementById("delete-task-modal"),r=document.getElementById("delete-modal-content"),d=document.getElementById("task-to-delete"),u=document.getElementById("delete-task-form"),m=document.getElementById("close-delete-modal"),f=document.getElementById("cancel-delete-task");let v=null,y=null;function L(){a.classList.add("opacity-0","invisible"),r.classList.remove("scale-100"),r.classList.add("scale-95"),v=null,y=null}document.addEventListener("click",function(e){if(e.target.closest(".delete-task-btn")){e.preventDefault();const t=e.target.closest(".delete-task-btn");!function(e,t,n){v=e,y=n,d.textContent=t,u.action=n,a.classList.remove("opacity-0","invisible"),r.classList.remove("scale-95"),r.classList.add("scale-100"),setTimeout(()=>f.focus(),100)}(t.dataset.taskId,t.dataset.taskText,t.dataset.deleteUrl)}}),m.addEventListener("click",L),f.addEventListener("click",L),a.addEventListener("click",function(e){e.target===a&&L()}),document.addEventListener("keydown",function(e){"Escape"!==e.key||a.classList.contains("invisible")||L()}),u.addEventListener("submit",function(e){if(e.preventDefault(),!v||!y)return;const t=u.querySelector('button[type="submit"]'),n=t.innerHTML;t.innerHTML='<i class="fas fa-spinner fa-spin mr-2"></i>Deleting...',t.disabled=!0,fetch(y,{method:"POST",headers:{"X-CSRFToken":document.querySelector("[name=csrfmiddlewaretoken]").value,"HX-Request":"true"}}).then(e=>{if(!e.ok)throw new Error("Delete failed");{const e=document.getElementById(`task-${v}`);e&&(e.style.transform="translateX(-100%)",e.style.opacity="0",setTimeout(()=>e.remove(),300)),L()}}).catch(e=>{console.error("Error deleting task:",e),alert("Failed to delete task. Please try again.")}).finally(()=>{t.innerHTML=n,t.disabled=!1})});const p=document.getElementById("modal"),h=document.getElementById("modal-content");function b(){document.querySelectorAll(".task-form").forEach(e=>{const t=e.querySelector('input[name="text"]');t&&e.addEventListener("htmx:afterRequest",function(n){if(n.detail.successful){t.value="",e.classList.contains("add-task-form")?k(e):t.focus();const n=e.querySelector(".error-message");n&&(n.innerHTML="")}})})}function E(){document.querySelectorAll(".add-task-form").forEach(e=>{const t=e.querySelector(".add-task-trigger"),n=e.querySelector(".add-task-collapsed"),s=e.querySelector(".add-task-expanded"),o=e.querySelector(".add-task-cancel"),c=e.querySelector('input[name="text"]');t&&n&&s&&o&&c&&(t.addEventListener("click",function(t){t.preventDefault(),g(e)}),o.addEventListener("click",function(t){t.preventDefault(),k(e)}),c.addEventListener("focus",function(){"none"!==n.style.display&&g(e)}))}),document.addEventListener("click",function(e){e.target.closest(".add-task-form")||document.querySelectorAll(".add-task-form").forEach(e=>{k(e)})}),document.addEventListener("keydown",function(e){"Escape"===e.key&&document.querySelectorAll(".add-task-form").forEach(e=>{k(e)})})}function g(e){const t=e.querySelector(".add-task-collapsed"),n=e.querySelector(".add-task-expanded"),s=e.querySelector('input[name="text"]');t&&n&&s&&(t.style.display="none",n.classList.remove("hidden"),setTimeout(()=>{s.focus()},100))}function k(e){const t=e.querySelector(".add-task-collapsed"),n=e.querySelector(".add-task-expanded"),s=e.querySelector('input[name="text"]'),o=e.querySelector(".error-message");t&&n&&(t.style.display="block",n.classList.add("hidden"),s&&(s.value="",s.classList.remove("border-red-500"),s.classList.add("border-[var(--inline-input-border)]")),o&&(o.innerHTML=""))}function w(){const e=document.querySelector(".grid-container");if(!e)return;let t=null;function n(){const t=e.querySelector(".grid-table");if(!t)return;const n=(parseInt(e.dataset.totalColumns)||0)-1;if(0===n)return;const s=window.innerWidth;let o=300,c=350;s<=768?(o=200,c=280):s<=1024&&(c=320);const i=o+n*c;t.style.width=i+"px"}function s(){const e=window.innerWidth;return e<=768?280:e<=1024?320:350}function o(){if(!t)return;const n=document.querySelector(".grid-scroll-progress"),s=(parseInt(e.dataset.totalColumns)||0)-1>3;if(s){const s=Math.round(e.scrollLeft),o=Math.round(e.scrollWidth-e.clientWidth),c=s<o-5;if(s>5?(t.leftBtn.classList.add("active"),t.leftBtn.disabled=!1):(t.leftBtn.classList.remove("active"),t.leftBtn.disabled=!0),c?(t.rightBtn.classList.add("active"),t.rightBtn.disabled=!1):(t.rightBtn.classList.remove("active"),t.rightBtn.disabled=!0),n){const e=o>0?s/o*100:0;n.style.width=Math.min(100,Math.max(0,e))+"%"}}else t.leftBtn.classList.remove("active"),t.leftBtn.disabled=!0,t.rightBtn.classList.remove("active"),t.rightBtn.disabled=!0,n&&(n.style.width="0%");const o=s&&e.scrollLeft>5,c=s&&e.scrollLeft<e.scrollWidth-e.clientWidth-5;e.classList.toggle("can-scroll-left",o),e.classList.toggle("can-scroll-right",c)}n(),function(){const n=document.querySelector(".left-scroll-btn"),c=document.querySelector(".right-scroll-btn");if(!n||!c)return;t={leftBtn:n,rightBtn:c};const i=document.createElement("div");i.className="grid-scroll-progress-track";const l=document.createElement("div");l.className="grid-scroll-progress",l.style.width="0%",i.appendChild(l),e.parentElement.appendChild(i),n.addEventListener("click",()=>{const t=s(),n=e.scrollLeft,c=Math.max(0,Math.floor(n/t)*t-t);e.scrollTo({left:c,behavior:"smooth"}),setTimeout(o,50),setTimeout(o,300)}),c.addEventListener("click",()=>{const t=s(),n=e.scrollLeft,c=e.scrollWidth-e.clientWidth,i=Math.min(c,Math.ceil(n/t)*t+t);e.scrollTo({left:i,behavior:"smooth"}),setTimeout(o,50),setTimeout(o,300)})}(),o(),e.addEventListener("scroll",o),setTimeout(o,100),setTimeout(o,500),window.addEventListener("resize",function(){n(),setTimeout(o,100)}),e.addEventListener("keydown",function(t){if("ArrowLeft"===t.key&&t.ctrlKey){t.preventDefault();const n=s(),o=e.scrollLeft,c=Math.max(0,Math.floor(o/n)*n-n);e.scrollTo({left:c,behavior:"smooth"})}else if("ArrowRight"===t.key&&t.ctrlKey){t.preventDefault();const n=s(),o=e.scrollLeft,c=e.scrollWidth-e.clientWidth,i=Math.min(c,Math.ceil(o/n)*n+n);e.scrollTo({left:i,behavior:"smooth"})}}),e.tabIndex=0,e.style.outline="none",e.style.scrollBehavior="auto",e.addEventListener("wheel",function(e){Math.abs(e.deltaX)>Math.abs(e.deltaY)&&e.preventDefault()},{passive:!1})}document.body.addEventListener("openModal",function(){p.classList.remove("opacity-0","invisible"),p.classList.add("opacity-100","visible"),h.classList.remove("scale-95"),h.classList.add("scale-100")}),document.body.addEventListener("closeModal",function(){p.classList.add("opacity-0","invisible"),p.classList.remove("opacity-100","visible"),h.classList.add("scale-95"),h.classList.remove("scale-100")}),document.body.addEventListener("refreshGrid",function(){window.location.reload()}),p.addEventListener("click",function(e){e.target===p&&document.body.dispatchEvent(new Event("closeModal"))}),document.addEventListener("keydown",function(e){"Escape"!==e.key||p.classList.contains("invisible")||document.body.dispatchEvent(new Event("closeModal"))}),document.addEventListener("click",function(e){e.target.closest(".close-modal")&&document.body.dispatchEvent(new Event("closeModal"))}),b(),E(),document.body.addEventListener("htmx:afterSwap",function(){b(),E(),l()}),document.body.addEventListener("htmx:afterSettle",function(){b(),E(),l()}),w(),document.body.addEventListener("htmx:afterSettle",function(){w(),setTimeout(()=>{const e=document.querySelector(".grid-container");if(e){(()=>{const t=e.querySelector(".grid-table");if(!t)return;t.querySelectorAll("colgroup col.category-column");const n=t.querySelectorAll("colgroup col.data-column");if(0===n.length)return;const s=e.clientWidth,o=window.innerWidth;let c=300,i=380;o<=768?(c=150,i=320):o<=1024&&(i=350);const l=(s-c)/n.length;if(l>=i)t.style.width="100%",n.forEach(e=>{e.style.width=l+"px"});else{const e=c+n.length*i;t.style.width=e+"px",n.forEach(e=>{e.style.width=i+"px"})}})()}},100)})});