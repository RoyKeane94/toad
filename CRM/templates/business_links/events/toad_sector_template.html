{% extends "pages/layout.html" %}
{% load static %}

{% block title %}{{ template.playbook_name|default:"Toad" }}{% endblock %}

{% block extra_head %}
<style>
    #app {
        padding: 0 !important;
    }
    /* Remove grey background from hero video container */
    .tw-weddings .tw-hero-visual {
        background: transparent !important;
        box-shadow: none !important;
        padding: 0 !important;
    }
    .tw-weddings .tw-hero-visual-inner {
        background: transparent !important;
        min-height: auto !important;
    }
    /* Remove green background from video containers on mobile */
    @media (max-width: 768px) {
        .tw-weddings .tw-grid-video,
        .tw-weddings .tw-grid-visual {
            background: transparent !important;
            border: none !important;
            box-shadow: none !important;
            padding: 0 !important;
        }
        .tw-weddings .tw-hero-visual {
            background: transparent !important;
            box-shadow: none !important;
            padding: 0 !important;
        }
        .tw-weddings .tw-hero-visual-inner {
            background: transparent !important;
            min-height: auto !important;
        }
    }
</style>
{% endblock %}

{% block content %}
<div data-page="tw-sector-template" class="tw-weddings">
<section class="tw-section w-full" style="background: linear-gradient(to bottom, oklch(0.95 0.05 120), oklch(0.97 0.03 120) 25%, oklch(0.99 0.01 120) 50%, white 75%);">
    <div class="max-w-7xl mx-auto flex flex-col-reverse lg:flex-row items-center gap-10 px-5">
        <div class="space-y-6 max-w-2xl" data-tw-animate>
            <p class="text-xs uppercase tracking-[0.35em] text-[var(--primary-action-bg)] font-semibold">
                {{ template.playbook_name|default:"Playbook for clear, calm work" }}
            </p>
            <h1 class="text-4xl sm:text-5xl font-black text-gray-900 leading-tight">
                One clear view of everything {{ company_name|default:"your team" }} is juggling
            </h1>
            <p class="text-lg text-gray-600 leading-relaxed">
                {{ template.main_header_description|default:"You already have spreadsheets, notes and tools. Toad gives your team one shared grid to track the work, with the option to add more grids as different projects need their own space." }}
            </p>
            <p class="text-sm text-gray-500 leading-relaxed">
                Start from these example grids shaped for {{ company_name|default:"your world" }}, or build your own in seconds. Every row, column and checklist is yours to tweak so it feels like the way you already work — just tidier.
            </p>
            <div class="flex flex-wrap gap-4 tw-hero-cta">
                <a href="#example-grids" class="tw-cta-btn tw-cta-primary">
                    See your example grids
                </a>
                <a href="{% url 'accounts:register_1_month_pro_trial' %}" class="tw-cta-btn tw-cta-secondary" data-track-signup-click>
                    Start a team trial
                </a>
                <p class="text-sm text-gray-500 mt-4 text-left w-full">
                    30-day trial, no card required. Cancel anytime.
                </p>
                <p class="text-sm text-gray-500 mt-4 text-left w-full">
                    Invite your team. Share one grid. See if it helps.
                </p>
            </div>
        </div>
        <div class="tw-hero-visual w-full lg:w-1/2" data-tw-animate>
            <div class="tw-hero-visual-inner bg-transparent">
                {% if template.video_1 %}
                    <video controls class="w-full max-w-2xl mx-auto rounded-lg shadow-lg bg-transparent scroll-play-video" style="background: transparent;" muted>
                        <source src="{{ template.video_1.url }}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                {% else %}
                    <span>Video placeholder</span>
                {% endif %}
            </div>
        </div>
    </div>
</section>

{% if template.used_by %}
<section class="w-full tw-social-proof bg-white py-4" data-tw-animate>
    <div class="max-w-7xl mx-auto px-5">
        <ul>
            <li>{{ template.used_by }}</li>
            <li>Built for small teams with a lot to juggle</li>
            <li>No setup, no training, no clutter — just one shared overview</li>
            <li>Less “quick question” messages because the plan is visible</li>
        </ul>
    </div>
</section>
{% endif %}

<section id="example-grids" class="tw-section w-full bg-white">
    <div class="max-w-7xl mx-auto space-y-12 px-5">
        <div class="tw-section-heading" data-tw-animate>
            <h2>What Toad looks like for {{ company_name|default:"your team" }}</h2>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto mt-4">
                Toad starts from something familiar — your existing lists, checklists and plans — and turns them into one shared grid. No dashboards, no complexity, just a clear view so everyone knows what happens when, and who is doing it.
            </p>
        </div>

        <div class="space-y-16">
            <!-- Grid 1 -->
            <div class="tw-grid-block" data-tw-animate>
                <div class="tw-grid-text">
                    <p class="tw-grid-eyebrow">Grid 1 · {{ template.grid_1_title|default:"Delivery & operations" }}</p>
                    <h3>{{ template.grid_1_header_description|default:"Before: scattered tasks. After: one calm, visible plan." }}</h3>
                    <p>{{ template.grid_1_subheader|default:"Every task, dependency and owner in a single shared grid that …so you don’t need to rely on folders, printouts, and long message threads to remember what’s going on." }}</p>
                    <ul class="tw-grid-list">
                        {% if template.grid_1_bullet_1 %}<li>{{ template.grid_1_bullet_1 }}</li>{% endif %}
                        {% if template.grid_1_bullet_2 %}<li>{{ template.grid_1_bullet_2 }}</li>{% endif %}
                        {% if template.grid_1_bullet_3 %}<li>{{ template.grid_1_bullet_3 }}</li>{% endif %}
                        {% if template.grid_1_bullet_4 %}<li>{{ template.grid_1_bullet_4 }}</li>{% endif %}
                    </ul>
                </div>
                <div class="tw-grid-visual tw-grid-video">
                    {% if template.grid_1_video %}
                        <video controls class="w-full max-w-xl mx-auto rounded-lg shadow-lg scroll-play-video" muted>
                            <source src="{{ template.grid_1_video.url }}" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    {% else %}
                        <span>Video Demo Placeholder</span>
                    {% endif %}
                </div>
            </div>

            <!-- Grid 2 -->
            <div class="tw-grid-block tw-grid-block--reverse" data-tw-animate>
                <div class="tw-grid-text">
                    <p class="tw-grid-eyebrow">Grid 2 · {{ template.grid_2_title|default:"Pipeline & growth" }}</p>
                    <h3>{{ template.grid_2_header_description|default:"Turn scattered opportunities into one clear pipeline." }}</h3>
                    <p>{{ template.grid_2_subheader|default:"Keep enquiries, leads and follow-ups on one simple board instead of scattered across tools and inboxes, so nothing warm quietly slips away." }}</p>
                    <ul class="tw-grid-list">
                        {% if template.grid_2_bullet_1 %}<li>{{ template.grid_2_bullet_1 }}</li>{% endif %}
                        {% if template.grid_2_bullet_2 %}<li>{{ template.grid_2_bullet_2 }}</li>{% endif %}
                        {% if template.grid_2_bullet_3 %}<li>{{ template.grid_2_bullet_3 }}</li>{% endif %}
                        {% if template.grid_2_bullet_4 %}<li>{{ template.grid_2_bullet_4 }}</li>{% endif %}
                    </ul>
                </div>
                <div class="tw-grid-visual">
                    {% if template.grid_2_video %}
                        <video controls class="w-full max-w-xl mx-auto rounded-lg shadow-lg scroll-play-video" muted>
                            <source src="{{ template.grid_2_video.url }}" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    {% else %}
                        <span>Marketing Snapshot Placeholder</span>
                    {% endif %}
                </div>
            </div>

            <!-- Grid 3 -->
            <div class="tw-grid-block" data-tw-animate>
                <div class="tw-grid-text">
                    <p class="tw-grid-eyebrow">Grid 3 · {{ template.grid_3_title|default:"Personal planner" }}</p>
                    <h3>{{ template.grid_3_header_description|default:"Your quiet weekly control room." }}</h3>
                    <p>{{ template.grid_3_subheader|default:"A private, lightweight planner for people who want to see the week and season ahead in one place, without learning a new tool or maintaining a complex system." }}</p>
                    <ul class="tw-grid-list">
                        {% if template.grid_3_bullet_1 %}<li>{{ template.grid_3_bullet_1 }}</li>{% endif %}
                        {% if template.grid_3_bullet_2 %}<li>{{ template.grid_3_bullet_2 }}</li>{% endif %}
                        {% if template.grid_3_bullet_3 %}<li>{{ template.grid_3_bullet_3 }}</li>{% endif %}
                        {% if template.grid_3_bullet_4 %}<li>{{ template.grid_3_bullet_4 }}</li>{% endif %}
                    </ul>
                </div>
                <div class="tw-grid-visual tw-grid-visual--small">
                    {% if template.grid_3_video %}
                        <video controls class="w-full max-w-lg mx-auto rounded-lg shadow-lg scroll-play-video" muted>
                            <source src="{{ template.grid_3_video.url }}" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    {% else %}
                        <span>Personal Planner Snapshot Placeholder</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>

<section class="tw-section w-full bg-[var(--main-bg)]">
    <div class="max-w-7xl mx-auto space-y-10 px-5">
        <div class="tw-section-heading" data-tw-animate>
            <h2>{{ template.section_2_title|default:"Why teams like yours stick with Toad" }}</h2>
            <p class="text-sm text-gray-500 max-w-2xl mx-auto mt-2">
                Toad stays backstage. It gives you a shared picture, without adding a new process.
            </p>
        </div>
        <div class="tw-features">
            {% if template.section_2_card_1_title %}
            <div class="tw-feature-card" data-tw-animate>
                <h4>{{ template.section_2_card_1_title }}</h4>
                <p>{{ template.section_2_card_1_description|default:"" }}</p>
            </div>
            {% endif %}
            {% if template.section_2_card_2_title %}
            <div class="tw-feature-card" data-tw-animate>
                <h4>{{ template.section_2_card_2_title }}</h4>
                <p>{{ template.section_2_card_2_description|default:"" }}</p>
            </div>
            {% endif %}
            {% if template.section_2_card_3_title %}
            <div class="tw-feature-card" data-tw-animate>
                <h4>{{ template.section_2_card_3_title }}</h4>
                <p>{{ template.section_2_card_3_description|default:"" }}</p>
            </div>
            {% endif %}
            {% if template.section_2_card_4_title %}
            <div class="tw-feature-card" data-tw-animate>
                <h4>{{ template.section_2_card_4_title }}</h4>
                <p>{{ template.section_2_card_4_description|default:"" }}</p>
            </div>
            {% endif %}
        </div>
    </div>
</section>

<section class="tw-section w-full bg-white">
    <div class="max-w-7xl mx-auto text-center space-y-6 px-5" data-tw-animate>
        <div class="tw-section-heading">
            <h2>
                Ready to try this with your team?
        </h2>
        </div>
        <p class="text-lg text-gray-600">
            Start with one shared grid. Invite a couple of people.
        </p>
        <p class="text-lg text-gray-600">
            You'll know quickly if it makes work feel calmer and clearer.
        </p>
        <div class="flex flex-col items-center">
            <a href="{% url 'accounts:register_1_month_pro_trial' %}" class="tw-cta-btn tw-cta-primary mb-3" data-track-signup-click>
                Start a Team trial
            </a>
            <p class="text-sm text-gray-500">
                No setup. No migration. Cancel anytime.
            </p>
        </div>
    </div>
</section>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const videos = document.querySelectorAll('.scroll-play-video');
    
    // Options for Intersection Observer
    const options = {
        root: null, // viewport
        rootMargin: '0px',
        threshold: 0.5 // Trigger when 50% of video is visible
    };
    
    // Callback for Intersection Observer
    const handleIntersection = (entries, observer) => {
        entries.forEach(entry => {
            const video = entry.target;
            
            if (entry.isIntersecting) {
                // Video is in view, play it
                video.play().catch(error => {
                    // Autoplay was prevented, user interaction required
                    console.log('Autoplay prevented:', error);
                });
            } else {
                // Video is out of view, pause it
                video.pause();
            }
        });
    };
    
    // Create Intersection Observer
    const observer = new IntersectionObserver(handleIntersection, options);
    
    // Observe all videos
    videos.forEach(video => {
        observer.observe(video);
        
        // Reset video to beginning when it goes out of view
        video.addEventListener('pause', function() {
            if (!this.ended) {
                // Only reset if video hasn't ended
                setTimeout(() => {
                    if (document.hidden || !this.offsetParent) {
                        this.currentTime = 0;
                    }
                }, 1000);
            }
        });
    });
});

// Template tracking - view count and sign-up clicks
(function() {
    {% if company_id %}
    const companyId = {{ company_id }};
    let viewTracked = false;
    let viewTrackingTimeout = null;
    
    // Track view count after 2 seconds on page
    function trackView() {
        if (viewTracked) return;
        viewTracked = true;
        
        fetch('{% url "crm:track_template_view" company_id=company_id %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            credentials: 'same-origin'
        }).catch(err => {
            // Silently fail - tracking is not critical
            console.log('View tracking failed:', err);
        });
    }
    
    // Start 2-second timer when page loads
    viewTrackingTimeout = setTimeout(trackView, 2000);
    
    // Track view immediately if user navigates away before 2 seconds
    // (but only if they've been interacting with the page)
    let hasInteracted = false;
    document.addEventListener('mousedown', function() {
        hasInteracted = true;
    });
    document.addEventListener('touchstart', function() {
        hasInteracted = true;
    });
    document.addEventListener('keydown', function() {
        hasInteracted = true;
    });
    
            // If user is leaving and has interacted, track view
    window.addEventListener('beforeunload', function() {
        if (hasInteracted && !viewTracked) {
            // Use sendBeacon for reliable tracking on page unload
            if (navigator.sendBeacon) {
                const formData = new FormData();
                navigator.sendBeacon('{% url "crm:track_template_view" company_id=company_id %}', formData);
            } else {
                // Fallback: try synchronous fetch (may be cancelled by browser)
                trackView();
            }
        }
    });
    
    // Track sign-up link clicks
    document.querySelectorAll('[data-track-signup-click]').forEach(function(link) {
        link.addEventListener('click', function(e) {
            // Track the click
            fetch('{% url "crm:track_sign_up_click" company_id=company_id %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                credentials: 'same-origin'
            }).catch(err => {
                // Silently fail - tracking is not critical
                console.log('Click tracking failed:', err);
            });
            
            // Let the link proceed normally
            // (no preventDefault, so navigation continues)
        });
    });
    {% endif %}
})();
</script>
{% endblock %}
