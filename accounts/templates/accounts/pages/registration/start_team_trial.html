{% extends 'pages/layout.html' %}
{% load static %}

{% block title %}Start Team Trial - Toad{% endblock %}

{% block extra_head %}
<style>
    #app { padding: 0 !important; }
    main { flex: 1 !important; display: flex !important; flex-direction: column !important; }
    .register-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        padding: 2rem 1rem 4rem;
        background: linear-gradient(to bottom, oklch(0.95 0.05 120), oklch(0.97 0.03 120) 25%, oklch(0.99 0.01 120) 50%, white 75%);
    }
    .register-card {
        max-width: 520px;
        width: 100%;
        background: white;
        border-radius: 16px;
        padding: 2rem;
        border: 1px solid #d1fae5;
        box-shadow: 0 10px 40px rgba(16, 185, 129, 0.12);
    }
    .team-size-btn {
        width: 2.75rem;
        height: 2.75rem;
        border: 2px solid #d1d5db;
        border-radius: 10px;
        background: white;
        color: #374151;
        font-size: 1.25rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
        font-weight: 600;
    }
    .team-size-btn:hover:not(:disabled) {
        background: #10b981;
        color: white;
        border-color: #10b981;
        transform: scale(1.05);
    }
    .team-size-btn:disabled { opacity: 0.4; cursor: not-allowed; }
    .team-size-input {
        width: 80px;
        padding: 0.5rem;
        border: 2px solid #d1d5db;
        border-radius: 10px;
        font-size: 1.5rem;
        text-align: center;
        font-weight: 700;
        color: #065f46;
    }
    .team-size-input:focus {
        outline: none;
        border-color: #10b981;
        box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
    }
    .trial-badge {
        display: inline-flex;
        align-items: center;
        padding: 0.5rem 1rem;
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 700;
        box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
    }
    .features-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 0.75rem; }
    .feature-item { display: flex; align-items: center; color: #047857; }
    .feature-item i { margin-right: 0.5rem; color: #10b981; }
    @media (max-width: 768px) {
        .register-card { padding: 1.5rem; }
        .features-grid { grid-template-columns: 1fr; }
    }
</style>
{% endblock %}

{% block content %}
<div class="register-container">
    <div class="register-card">
        <div class="text-center">
            <div class="mb-4">
                <img src="{% static 'img/logo/toad_logo.png' %}" alt="Toad Logo" class="h-12 w-auto mx-auto">
            </div>
            <h2 class="text-2xl font-bold text-[#065f46]">Start Your Team Trial</h2>
            <p class="mt-2 text-sm text-[#047857]">Upgrade to Toad Pro and add your team. 1 month free.</p>
            <div class="mt-3">
                <span class="trial-badge"><i class="fas fa-gift mr-2"></i>No credit card required</span>
            </div>
        </div>

        <p class="text-sm text-[#047857] mt-4 mb-2 text-center">
            Your account will be upgraded to <strong>Toad Pro</strong> and you’ll be the team admin. Everyone on the team is on a trial.
        </p>

        <!-- Team size -->
        <div class="bg-emerald-50 border border-emerald-200 rounded-xl p-4 mb-4">
            <div class="text-center mb-3">
                <p class="text-sm font-medium text-[#065f46]">How many people on your team?</p>
            </div>
            <div class="flex items-center justify-center gap-3">
                <button type="button" id="decrease-btn" class="team-size-btn" onclick="changeTeamSize(-1)">−</button>
                <input type="number" id="team-size-input" class="team-size-input" value="2" min="2" max="50" onchange="updateTeamSize()">
                <button type="button" id="increase-btn" class="team-size-btn" onclick="changeTeamSize(1)">+</button>
            </div>
            <p class="text-xs text-center text-emerald-700 mt-3">
                <i class="fas fa-info-circle mr-1"></i>
                You'll be the admin. Invite <span id="invite-count">1</span> team member(s) after starting the trial.
            </p>
        </div>

        <div class="bg-white border border-gray-100 rounded-xl p-4 mb-4">
            <p class="text-xs font-semibold text-gray-700 mb-2">What's included:</p>
            <div class="features-grid">
                <div class="feature-item"><i class="fas fa-check"></i><span>Team collaboration</span></div>
                <div class="feature-item"><i class="fas fa-check"></i><span>Unlimited shared grids</span></div>
                <div class="feature-item"><i class="fas fa-check"></i><span>Custom templates</span></div>
                <div class="feature-item"><i class="fas fa-check"></i><span>Task archiving</span></div>
            </div>
        </div>

        {% if messages %}
            {% for message in messages %}
                {% if message.tags == 'error' %}
                <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm mb-4">
                    <div class="flex items-start">
                        <i class="fas fa-exclamation-triangle mr-2 mt-0.5 flex-shrink-0"></i>
                        <div>
                            <p class="font-medium mb-1">Something went wrong</p>
                            <p class="text-red-600 text-xs leading-relaxed">{{ message }}</p>
                        </div>
                    </div>
                </div>
                {% endif %}
            {% endfor %}
        {% endif %}

        <form method="post" class="space-y-4" id="start-trial-form">
            {% csrf_token %}
            <input type="hidden" name="team_size" id="team-size-hidden" value="2">
            <button type="submit" id="submit-btn" class="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-semibold rounded-lg transition-all duration-200 cursor-pointer shadow-lg hover:shadow-xl transform hover:-translate-y-0.5" style="background: linear-gradient(to right, #10b981, #22c55e) !important; color: white !important;">
                <span class="absolute left-0 inset-y-0 flex items-center pl-3">
                    <i class="fas fa-rocket text-white opacity-75 group-hover:opacity-100" id="submit-icon"></i>
                </span>
                <span id="submit-text">Start team trial</span>
                <span id="submit-loading" class="hidden">
                    <i class="fas fa-spinner fa-spin mr-2"></i>Setting up trial...
                </span>
            </button>
        </form>

        <p class="text-center text-xs text-gray-500 pt-2">Your 1-month trial starts immediately. No payment required.</p>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('start-trial-form');
    const submitBtn = document.getElementById('submit-btn');
    const submitText = document.getElementById('submit-text');
    const submitLoading = document.getElementById('submit-loading');
    const submitIcon = document.getElementById('submit-icon');
    updateTeamSize();
    form.addEventListener('submit', function() {
        if (typeof plausible !== 'undefined') plausible('team_trial_signup');
        submitBtn.disabled = true;
        submitText.classList.add('hidden');
        submitLoading.classList.remove('hidden');
        submitIcon.classList.add('hidden');
        submitBtn.classList.add('opacity-75', 'cursor-not-allowed');
    });
});
function changeTeamSize(delta) {
    const input = document.getElementById('team-size-input');
    const currentValue = parseInt(input.value) || 2;
    const newValue = Math.max(2, Math.min(50, currentValue + delta));
    input.value = newValue;
    updateTeamSize();
}
function updateTeamSize() {
    const input = document.getElementById('team-size-input');
    const teamSize = parseInt(input.value) || 2;
    const inviteCount = Math.max(1, teamSize - 1);
    document.getElementById('invite-count').textContent = inviteCount;
    document.getElementById('team-size-hidden').value = teamSize;
    document.getElementById('decrease-btn').disabled = teamSize <= 2;
    document.getElementById('increase-btn').disabled = teamSize >= 50;
}
</script>
{% endblock %}
