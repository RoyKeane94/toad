{% extends "pages/layout.html" %}
{% load static %}

{% block title %}Admin Dashboard - Toad{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="mb-8">
        <div class="flex items-center space-x-3">
            <div class="flex items-center justify-center w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg shadow-sm">
                <i class="fas fa-chart-line text-white text-xl"></i>
            </div>
            <div>
                <h1 class="text-2xl font-bold text-[var(--title-text)]">Admin Dashboard</h1>
                <p class="text-sm text-[var(--text-secondary)] mt-1">Analytics and user insights for Toad</p>
            </div>
        </div>
    </div>

    <!-- Key Metrics -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <!-- Total Users -->
        <div class="bg-[var(--container-bg)] border border-[var(--border-color)] rounded-lg p-6">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-users text-blue-600"></i>
                    </div>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-[var(--text-secondary)]">Total Users</p>
                    <p class="text-2xl font-bold text-[var(--title-text)]">{{ total_users }}</p>
                </div>
            </div>
        </div>

        <!-- Used in last day -->
        <div class="bg-[var(--container-bg)] border border-[var(--border-color)] rounded-lg p-6">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-bolt text-green-600"></i>
                    </div>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-[var(--text-secondary)]">Used in last day</p>
                    <p class="text-2xl font-bold text-[var(--title-text)]">{{ last_day_active_users }}</p>
                    <p class="text-sm text-green-600">Used in last day %: {{ last_day_active_percentage }}%</p>
                </div>
            </div>
        </div>

        <!-- Used in last 3 days -->
        <div class="bg-[var(--container-bg)] border border-[var(--border-color)] rounded-lg p-6">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <div class="w-8 h-8 bg-emerald-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-clock text-emerald-600"></i>
                    </div>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-[var(--text-secondary)]">Used in last 3 days</p>
                    <p class="text-2xl font-bold text-[var(--title-text)]">{{ last_3_days_active_users }}</p>
                    <p class="text-sm text-emerald-600">Used in last 3 days %: {{ last_3_days_active_percentage }}%</p>
                </div>
            </div>
        </div>

        <!-- Weekly Active Users -->
        <div class="bg-[var(--container-bg)] border border-[var(--border-color)] rounded-lg p-6">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-calendar-week text-green-600"></i>
                    </div>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-[var(--text-secondary)]">Weekly Active</p>
                    <p class="text-2xl font-bold text-[var(--title-text)]">{{ weekly_active_users }}</p>
                    <p class="text-sm text-green-600">{{ weekly_active_percentage }}%</p>
                </div>
            </div>
        </div>

        <!-- Monthly Active Users -->
        <div class="bg-[var(--container-bg)] border border-[var(--border-color)] rounded-lg p-6">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-calendar-alt text-purple-600"></i>
                    </div>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-[var(--text-secondary)]">Monthly Active</p>
                    <p class="text-2xl font-bold text-[var(--title-text)]">{{ monthly_active_users }}</p>
                    <p class="text-sm text-purple-600">{{ monthly_active_percentage }}%</p>
                </div>
            </div>
        </div>

        <!-- Inactive Users -->
        <div class="bg-[var(--container-bg)] border border-[var(--border-color)] rounded-lg p-6">
            <div class="flex items-center">
                <div class="flex-shrink-0">
                    <div class="w-8 h-8 bg-red-100 rounded-lg flex items-center justify-center">
                        <i class="fas fa-user-clock text-red-600"></i>
                    </div>
                </div>
                <div class="ml-4">
                    <p class="text-sm font-medium text-[var(--text-secondary)]">Inactive Users</p>
                    <p class="text-2xl font-bold text-[var(--title-text)]">{{ inactive_users }}</p>
                    <p class="text-sm text-red-600">{{ inactive_percentage }}%</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Users by Tier -->
    <div class="bg-[var(--container-bg)] border border-[var(--border-color)] rounded-lg p-6 mb-8">
        <h2 class="text-lg font-semibold text-[var(--title-text)] mb-4">Users by Tier</h2>
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
            <!-- Beta Users -->
            <div class="bg-gradient-to-br from-purple-50 to-purple-100 border border-purple-200 rounded-lg p-4">
                <div class="text-center">
                    <div class="w-8 h-8 bg-purple-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                        <i class="fas fa-flask text-purple-600"></i>
                    </div>
                    <p class="text-2xl font-bold text-[var(--title-text)]">{{ beta_users }}</p>
                    <p class="text-sm text-[var(--text-secondary)]">Beta Users</p>
                    <p class="text-xs text-purple-600">{{ beta_percentage }}%</p>
                </div>
            </div>
            
            <!-- Free Users -->
            <div class="bg-gradient-to-br from-gray-50 to-gray-100 border border-gray-200 rounded-lg p-4">
                <div class="text-center">
                    <div class="w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                        <i class="fas fa-user text-gray-600"></i>
                    </div>
                    <p class="text-2xl font-bold text-[var(--title-text)]">{{ free_users }}</p>
                    <p class="text-sm text-[var(--text-secondary)]">Free Users</p>
                    <p class="text-xs text-gray-600">{{ free_percentage }}%</p>
                </div>
            </div>
            
            <!-- Personal Users -->
            <div class="bg-gradient-to-br from-green-50 to-green-100 border border-green-200 rounded-lg p-4">
                <div class="text-center">
                    <div class="w-8 h-8 bg-green-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                        <i class="fas fa-crown text-green-600"></i>
                    </div>
                    <p class="text-2xl font-bold text-[var(--title-text)]">{{ personal_users }}</p>
                    <p class="text-sm text-[var(--text-secondary)]">Personal Users</p>
                    <p class="text-xs text-green-600">{{ personal_percentage }}%</p>
                </div>
            </div>
            
            <!-- Personal Trial Users -->
            <div class="bg-gradient-to-br from-amber-50 to-amber-100 border border-amber-200 rounded-lg p-4">
                <div class="text-center">
                    <div class="w-8 h-8 bg-amber-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                        <i class="fas fa-clock text-amber-600"></i>
                    </div>
                    <p class="text-2xl font-bold text-[var(--title-text)]">{{ personal_trial_users }}</p>
                    <p class="text-sm text-[var(--text-secondary)]">Personal Trial</p>
                    <p class="text-xs text-amber-600">{{ personal_trial_percentage }}%</p>
                </div>
            </div>
            
            <!-- Personal 3 Month Trial Users -->
            <div class="bg-gradient-to-br from-orange-50 to-orange-100 border border-orange-200 rounded-lg p-4">
                <div class="text-center">
                    <div class="w-8 h-8 bg-orange-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                        <i class="fas fa-calendar-check text-orange-600"></i>
                    </div>
                    <p class="text-2xl font-bold text-[var(--title-text)]">{{ personal_3_month_trial_users }}</p>
                    <p class="text-sm text-[var(--text-secondary)]">Personal 3 Month Trial</p>
                    <p class="text-xs text-orange-600">{{ personal_3_month_trial_percentage }}%</p>
                </div>
            </div>
            
            <!-- Pro Users -->
            <div class="bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-lg p-4">
                <div class="text-center">
                    <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                        <i class="fas fa-star text-blue-600"></i>
                    </div>
                    <p class="text-2xl font-bold text-[var(--title-text)]">{{ pro_users }}</p>
                    <p class="text-sm text-[var(--text-secondary)]">Pro Users</p>
                    <p class="text-xs text-blue-600">{{ pro_percentage }}%</p>
                </div>
            </div>
            
            <!-- Society Pro Users -->
            <div class="bg-gradient-to-br from-indigo-50 to-indigo-100 border border-indigo-200 rounded-lg p-4">
                <div class="text-center">
                    <div class="w-8 h-8 bg-indigo-100 rounded-lg flex items-center justify-center mx-auto mb-2">
                        <i class="fas fa-university text-indigo-600"></i>
                    </div>
                    <p class="text-2xl font-bold text-[var(--title-text)]">{{ society_pro_users }}</p>
                    <p class="text-sm text-[var(--text-secondary)]">Society Pro</p>
                    <p class="text-xs text-indigo-600">{{ society_pro_percentage }}%</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Users by Grid Count -->
    <div class="bg-[var(--container-bg)] border border-[var(--border-color)] rounded-lg p-6">
        <h2 class="text-lg font-semibold text-[var(--title-text)] mb-4">Users by Grid Count</h2>
        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
            <!-- 1 Grid -->
            <div class="bg-[var(--grid-header-bg)] border border-[var(--border-color)] rounded-lg p-4">
                <div class="text-center">
                    <p class="text-2xl font-bold text-[var(--title-text)]">{{ users_with_1_grid }}</p>
                    <p class="text-sm text-[var(--text-secondary)]">1 grid</p>
                </div>
            </div>
            
            <!-- 2 Grids -->
            <div class="bg-[var(--grid-header-bg)] border border-[var(--border-color)] rounded-lg p-4">
                <div class="text-center">
                    <p class="text-2xl font-bold text-[var(--title-text)]">{{ users_with_2_grids }}</p>
                    <p class="text-sm text-[var(--text-secondary)]">2 grids</p>
                </div>
            </div>
            
            <!-- 3 Grids -->
            <div class="bg-[var(--grid-header-bg)] border border-[var(--border-color)] rounded-lg p-4">
                <div class="text-center">
                    <p class="text-2xl font-bold text-[var(--title-text)]">{{ users_with_3_grids }}</p>
                    <p class="text-sm text-[var(--text-secondary)]">3 grids</p>
                </div>
            </div>
            
            <!-- 4 Grids -->
            <div class="bg-[var(--grid-header-bg)] border border-[var(--border-color)] rounded-lg p-4">
                <div class="text-center">
                    <p class="text-2xl font-bold text-[var(--title-text)]">{{ users_with_4_grids }}</p>
                    <p class="text-sm text-[var(--text-secondary)]">4 grids</p>
                </div>
            </div>
            
            <!-- 5 Grids -->
            <div class="bg-[var(--grid-header-bg)] border border-[var(--border-color)] rounded-lg p-4">
                <div class="text-center">
                    <p class="text-2xl font-bold text-[var(--title-text)]">{{ users_with_5_grids }}</p>
                    <p class="text-sm text-[var(--text-secondary)]">5 grids</p>
                </div>
            </div>
            
            <!-- 6 Grids -->
            <div class="bg-[var(--grid-header-bg)] border border-[var(--border-color)] rounded-lg p-4">
                <div class="text-center">
                    <p class="text-2xl font-bold text-[var(--title-text)]">{{ users_with_6_grids }}</p>
                    <p class="text-sm text-[var(--text-secondary)]">6 grids</p>
                </div>
            </div>
            
            <!-- 7 Grids -->
            <div class="bg-[var(--grid-header-bg)] border border-[var(--border-color)] rounded-lg p-4">
                <div class="text-center">
                    <p class="text-2xl font-bold text-[var(--title-text)]">{{ users_with_7_grids }}</p>
                    <p class="text-sm text-[var(--text-secondary)]">7 grids</p>
                </div>
            </div>
            
            <!-- 8 Grids -->
            <div class="bg-[var(--grid-header-bg)] border border-[var(--border-color)] rounded-lg p-4">
                <div class="text-center">
                    <p class="text-2xl font-bold text-[var(--title-text)]">{{ users_with_8_grids }}</p>
                    <p class="text-sm text-[var(--text-secondary)]">8 grids</p>
                </div>
            </div>
            
            <!-- 9 Grids -->
            <div class="bg-[var(--grid-header-bg)] border border-[var(--border-color)] rounded-lg p-4">
                <div class="text-center">
                    <p class="text-2xl font-bold text-[var(--title-text)]">{{ users_with_9_grids }}</p>
                    <p class="text-sm text-[var(--text-secondary)]">9 grids</p>
                </div>
            </div>
            
            <!-- 10 Grids -->
            <div class="bg-[var(--grid-header-bg)] border border-[var(--border-color)] rounded-lg p-4">
                <div class="text-center">
                    <p class="text-2xl font-bold text-[var(--title-text)]">{{ users_with_10_grids }}</p>
                    <p class="text-sm text-[var(--text-secondary)]">10 grids</p>
                </div>
            </div>
            
            <!-- 10+ Grids -->
            <div class="bg-[var(--grid-header-bg)] border border-[var(--border-color)] rounded-lg p-4">
                <div class="text-center">
                    <p class="text-2xl font-bold text-[var(--title-text)]">{{ users_with_10_plus_grids }}</p>
                    <p class="text-sm text-[var(--text-secondary)]">10+ grids</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Tasks per User Distribution -->
    <div class="bg-[var(--container-bg)] border border-[var(--border-color)] rounded-lg p-6 mt-8">
        <h2 class="text-lg font-semibold text-[var(--title-text)] mb-4">Tasks per User (Distribution)</h2>
        <div class="relative w-full h-64">
            <canvas id="tasksPerUserChart"></canvas>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{# Safely embed JSON data for the chart #}
{{ task_distribution_labels|json_script:"task-dist-labels" }}
{{ task_distribution_counts|json_script:"task-dist-counts" }}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const canvasEl = document.getElementById('tasksPerUserChart');
  const labelsEl = document.getElementById('task-dist-labels');
  const countsEl = document.getElementById('task-dist-counts');
  if (!canvasEl || !labelsEl || !countsEl || typeof Chart === 'undefined') return;
  const labels = JSON.parse(labelsEl.textContent);
  const dataCounts = JSON.parse(countsEl.textContent);
  const ctx = canvasEl.getContext('2d');
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: 'Users',
        data: dataCounts,
        backgroundColor: 'rgba(16, 185, 129, 0.5)',
        borderColor: 'rgba(16, 185, 129, 1)',
        borderWidth: 1,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: { beginAtZero: true, ticks: { precision:0 } }
      },
      plugins: {
        legend: { display: false }
      }
    }
  });
});
</script>
{% endblock %}
