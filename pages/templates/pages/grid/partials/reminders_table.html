{% load custom_filters %}

{% if reminder_tasks %}
<div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-[var(--border-color)]">
        <thead class="bg-[var(--grid-header-bg)]">
            <tr>
                <th class="px-4 py-3 text-left text-xs font-medium text-[var(--text-secondary)] uppercase tracking-wider">
                    Task
                </th>
                <th class="px-4 py-3 text-center text-xs font-medium text-[var(--text-secondary)] uppercase tracking-wider">
                    Owner
                </th>
                <th class="px-4 py-3 text-left text-xs font-medium text-[var(--text-secondary)] uppercase tracking-wider">
                    Date
                </th>
                <th class="px-4 py-3 text-left text-xs font-medium text-[var(--text-secondary)] uppercase tracking-wider">
                    Due
                </th>
            </tr>
        </thead>
        <tbody class="bg-[var(--container-bg)] divide-y divide-[var(--border-color)]">
            {% for task in reminder_tasks %}
            <tr>
                <td class="px-4 py-3 text-sm text-[var(--text-primary)] align-top">
                    <div class="flex items-start gap-2">
                        {% if task.completed %}
                            <i class="fas fa-check-circle mt-0.5 text-green-600 opacity-80" title="Completed"></i>
                        {% endif %}
                        <span class="font-bold {% if task.completed %}line-through opacity-60 font-medium{% endif %}">
                            {{ task.text }}
                        </span>
                    </div>
                </td>
                <td class="px-4 py-3 text-sm text-[var(--text-secondary)] align-top text-center opacity-70">
                    {% if task.assigned_to %}
                        <div class="flex items-center justify-center">
                            <div class="assignee-avatar"
                                 style="width: 24px; height: 24px; border-radius: 50%; background-color: {{ task.assigned_to.pk|get_avatar_color }}; color: white; font-weight: 600; font-size: 10px; display: flex; align-items: center; justify-content: center;"
                                 title="{{ task.assigned_to.get_full_name }}">
                                {{ task.assigned_to.get_full_name|get_smart_initials:project.team_toad_user.all }}
                            </div>
                        </div>
                    {% endif %}
                </td>
                <td class="px-4 py-3 text-sm text-[var(--text-primary)] align-top opacity-70">
                    {{ task.get_reminder_date_display|default:"-" }}
                </td>
                <td class="px-4 py-3 text-sm text-[var(--text-primary)] align-top opacity-70">
                    {% if task.days_until is not None %}
                        {% if task.days_until < 0 %}
                            <span class="text-red-600">{{ task.days_ago }} days ago</span>
                        {% elif task.days_until == 0 %}
                            <span class="text-orange-600">Today</span>
                        {% else %}
                            {{ task.days_until }} day{{ task.days_until|pluralize }}
                        {% endif %}
                    {% else %}
                        -
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<p class="text-sm text-[var(--text-secondary)]">
    There are no reminders set on this grid yet.
</p>
{% endif %}

